# 1.2 IoC/DI를 위한 빈 설정 메타정보 작성

IoC 컨테이너의 가장 기본적인 역할은 코드를 대신해서 애플리케이션을 구성하는 오브젝트를 생성하고 관리하는 것이다.  
POJO로 만들어진 애플리케이션 클래스와 서비스 오브젝트들이 그 대상이다.

## 1.2.1 빈 설정 메타 정보

`BeanDefinition`에는 IoC 컨테이너가 빈을 만들 때 필요한 핵심 정보가 담겨 있다.  
몇 가지 필수 항목을 제외하면 컨테이너에 미리 설정된 디폴트 값이 그대로 적용된다.

### 빈 설정 메타 정보 항목

스프링의 IoC/DI 기술은 단순하게 클래스로 오브젝트를 만들고 프로퍼티 설정하는 것이 전부가 아니다.  
스프링은 오브젝트를 컨테이너가 생성하고 관리하는 과정에서 필요한 매우 세밀하고 유연한 방법을 제공한다.

## 1.2.2 빈 등록 방법

빈 등록은 빈 메타 정보를 작성해서 컨테이너에게 건네주면 된다.  
가장 직접적이고 원시적인 방법은 BeanDefinition 구현 오브젝트를 직접 생성하는 것이지만 스프링을 확장해서 프레임워크를 만들거나 스프링의 내부 동작 원리를 학습하려는 게 목적이 아니라면 이 방법은 무리가 있다.  
그래서 보통 XML 문서, 프로퍼티 파일, 소스코드 애노테이션과 같은 외부 리소스로 빈 메타 정보를 작성하고 이를 적절한 리더나 변환기를 통해 애플리케이션 컨텍스트가 사용할 수 있는 정보로 변환해 주는 방법을 사용한다.

### 자동 인식을 이용한 빈 등록: 스테레오타입 애노테이션과 빈 스캐너

빈으로 사용될 클래스에 특별한 애노테이션을 부여해 주면 이런 클래스를 자동으로 찾아서 빈으로 등록해 주게 할 수 있다.  
이렇게 특정 애노테이션이 붙은 클래스를 자동으로 찾아서 빈으로 등록해 주는 방식을 빈 스캐닝(scanning)을 통한 자동 인식 빈 등록 기능이라고 하고, 이런 스캐닝 작업을 담당하는 오브젝트를 빈 스캐너(scanner)라고 한다.

스프링의 빈 스캐너는 **지정된 클래스패스 아래에 있는 모든 패키지의 클래스를 대상으로 필터를 적용해서 빈 등록을 위한 클래스들을 선별**해낸다.  
빈 스캐너에 내장된 디폴트 필터는 `@Component` 애노테이션 또는 @Component를 메타 애노테이션으로 가진 애노테이션이 부여된 클래스를 선택하도록 되어 있다.  
@Component를 포함해 디폴트 필터에 적용되는 애노테이션을 스프링에서는 `스테레오타입(stereotype) 애노테이션`이라고 부른다.

### 자바 코드에 의한 빈 등록: @Configuration 클래스의 @Bean 메서드

빈 설정 메타 정보를 담고 있는 자바 코드는 `@Configuration` 애노테이션이 달린 클래스를 이용해 작성한다.  
클래스에 `@Bean`이 붙은 메서드를 정의할 수 있는데, 이 @Bean 메서드를 통해 빈을 정의할 수 있다.

스프링은 @Bean이 붙은 메서드를 이용해서 빈을 만들 때, 싱글톤 빈이라면 한 개의 오브젝트만 생성이 되고 더 이상 새로운 오브젝트가 만들어지지 않도록 특별한 방법으로 @Bean 메서드를 조작해둔다.

자바 코드에 의한 설정이 XML과 같은 외부 설정 파일을 이용하는 것보다 유용한 점은 다음과 같다.

- 컴파일러나 IDE를 통한 타입 검증 가능
- 자동 완성과 같은 IDE 지원 기능을 최대한 이용 가능
- 이해하기 쉬움
- 복잡한 빈 설정이나 초기화 작업을 손쉽게 적용할 수 있음

### 자바 코드에 의한 빈 등록: 일반 빈 클래스의 @Bean 메서드

일반 POJO 클래스에서도 @Bean을 사용할 수 있다.  
이 경우에도 @Bean은 동일하게 새로운 빈을 정의하는 설정 메타 정보로 사용되고, 그 리턴 오브젝트가 빈 오브젝트가 된다.

그런데 @Configuration이 붙지 않은 @Bean 메서드는 @Configuration 클래스의 @Bean과 미묘한 차이점이 있기 때문에 주의해야 한다.  
**빈의 싱글톤 스코프가 보장되는 경우는 @Configuration 클래스 안에서 사용된 @Bean에만 해당**된다.  
일반 빈 클래스에 @Bean을 사용한 경우, 메서드를 호출할 때마다 매번 다른 객체를 얻게 된다.

## 1.2.3 빈 의존 관계 설정 방법

### 애노테이션: @Resource

@Resource는 \<property> 선언과 비슷하게 주입할 빈을 아이디로 지정하는 방법이다.  
@Resource는 자바 클래스의 수정자와 필드에 붙일 수 있다.  
@Resource는 기본적으로 참조할 빈의 이름을 이용해서 빈을 찾는다.  
만약 @Resource에 name 엘리먼트를 지정하지 않았고 디폴트 이름으로는 참조할 빈을 찾을 수 없는 경우 타입을 이용해 다시 한번 빈을 찾는다.

@Resource를 타입으로 빈을 찾게 하는 건, 컨텍스트가 자신에 대한 레퍼런스를 직접 제공하는 경우에만 적합하다.

### 애노테이션: @Autowired/@Inject

이 두 가지 애노테이션은 기본적으로 타입에 의한 자동 와이어링 방식으로 동작한다.  
@Autowired는 스프링 2.5부터 적용된 스프링 전용 애노테이션이고 @Inject는 JavaEE 6의 표준 스펙인 JSR-330(Dependency Injection for Java)에 정의되어 있는 것으로, 스프링 외에도 JavaEE 6의 스펙을 따르는 여타 프레임워크에서도 동일한 의미로 사용되는 DI를 위한 애노테이션이다.

### 자바 코드에 의한 의존 관계 설정

@Configuration과 @Bean을 이용해서 자바 코드로 빈을 등록하는 경우에 빈의 의존 관계를 설정하는 세 가지 방법이 있다.

- 애노테이션에 의한 설정 @Autowired, @Resource
  - @Autowired와 같은 애노테이션을 통한 의존 관계 설정은 빈 오브젝트 등록을 마친 후에 후처리기에 의해 별도의 작업으로 진행됨
- @Bean 메서드 호출
  - 자바 코드로 DI 하는 가장 직관적인 방법
  - 코드를 보고 예상할 수 있는 일반적인 자바 코드의 동작 방식과 다르게 동작하기 때문에 스프링의 특별한 목적을 위해 사용되는 코드로 받아들이지 않으면 설정 정보에 대해 오해할 소지가 있음
- @Bean과 메서드 자동 와이어링
  - 빈의 레퍼런스를 파라미터로 주입받는 방식
  - 다른 빈의 레퍼런스를 메서드 호출이 아니라 파라미터로 받기 때문에 @Bean 메서드 호출을 이용했을 때보다 자바 코드가 자연스러움
