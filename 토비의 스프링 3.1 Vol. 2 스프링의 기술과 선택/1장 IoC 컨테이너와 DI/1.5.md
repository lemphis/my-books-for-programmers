# 1.5 스프링 3.1의 Ioc 컨테이너와 DI

스프링 3.1에 새롭게 도입된 IoC/DI 기술은 다음 두 가지다.

- 강화된 자바 코드 빈 설정
  - 자바 코드를 이용한 설정 방식을 빈 설정 메타 정보 작성에 본격적으로 사용할 수 있도록 기능을 대폭 확장한 것
- 런타임 환경 추상화
  - 개발과 테스트, 운영 단계에서 IoC/DI 구성이 달라질 때 이를 효과적으로 관리할 수 있게 해주는 런타임 환경 정보 관리 기능

## 1.5.1 빈의 역할과 구분

### 빈의 종류

- 애플리케이션 로직 빈
  - 애플리케이션의 로직을 담고 있는 주요 클래스의 오브젝트
  - 데이터 로직을 다루는 DAO, 비즈니스 로직과 기반 서비스를 다루는 서비스 오브젝트, 컨트롤러 오브젝트 등이 대표적임
- 애플리케이션 인프라 빈
  - 애플리케이션이 동작하는 데 직접 참여하나 개발자가 직접 작성하는 로직을 담고 있지 않은 오브젝트
  - DataSource, DataSourceTransactionManager가 대표적임
- 컨테이너 인프라 빈
  - 애플리케이션 로직을 담고 있지 않으며 다른 애플리케이션 로직을 담은 빈과 관계를 맺고 외부 서비스를 사용하는 데 도움을 주진 않지만 스프링 컨테이너의 기능에 관여하는 오브젝트
  - DefaultAdvisorAutoProxyCreator가 대표적임

### 컨테이너 인프라 빈과 전용 태그

컨테이너 인프라 빈은 DefaultAdvisorAutoProxyCreator처럼 \<bean> 태그를 이용해 직접 빈을 등록할 수 있지만 전용 태그를 사용하는 방법이 더 많이 쓰인다.  
@Configuration/@Bean은 물론이고 @Autowired 같은 애노테이션을 이용한 빈 의존 관계 설정 방식, @PostConstruct를 통한 빈 초기화 메서드 기능 모두 스프링 컨테이너가 기본적으로 제공하는 기능이 아니라 스프링 컨테이너의 기능을 확장할 수 있는 컨테이너 인프라 빈이 제공하는 기능이다.

\<context:annotation-config> 태그를 추가하면 6개의 컨테이너 인프라 빈이 추가로 등록된다.

- ConfigurationClassPostProcessor$ImportAwareBeanPostProcessor
- ConfigurationClassPostProcessor
- AutowiredAnnotationBeanPostProcessor
- RequiredAnnotationBeanPostProcessor
- PersistenceAnnotationBeanPostProcessor

### 빈의 역할

스프링의 BeanDefinition 인터페이스에는 ROLE_로 시작하는 상수가 있다.  
이 상숫값은 빈의 메타 정보 오브젝트의 role 프로퍼티 값을 지정할 때 사용되는 것이다.  
BeanDefinition에는 다음과 같은 3개의 역할이 정의되어 있다.  
스프링의 빈을 역할에 따라 구분한다면 이 세 가지로 나눌 수 있다.

```java
// 애플리케이션 로직 빈과 애플리케이션 인프라 빈처럼 애플리케이션이 동작하는 중에 사용되는 빈
int ROLE_APPLICATION = 0;
// 복합 구조의 빈을 정의할 때 보조적으로 사용되는 빈. 거의 사용되지 않음
int ROLE_SUPPORT = 1;
// 컨테이너 인프라 빈
int ROLE_INFRASTRUCTURE = 2;
```

스프링 3.1부터는 개발자가 빈을 정의할 때 이 역할 값을 직접 지정할 수 있도록 @Role이라는 애노테이션이 도입됐다.
