# 2.1 공통 개념

## 2.1.1 DAO 패턴

데이터 액세스 계층은 DAO 패턴이라 불리는 방식으로 분리하는 것이 원칙이다.  
DAO 패턴은 **DTO 또는 도메인 오브젝트만을 사용하는 인터페이스를 통해 데이터 액세스 기술을 외부에 노출하지 않도록 만드는 것**이다.  
따라서 DAO는 구현 기술에 대한 정보를 외부에 공개해서는 안 된다.  
이를 통해 DAO를 사용하는 코드에 영향을 주지 않고 데이터 액세스 기술을 변경하거나 하나 이상의 데이터 액세스 기술을 혼합해서 사용할 수 있게 해준다.  
가장 중요한 점은 **DAO를 이용하는 서비스 계층의 코드를 기술이나 환경에 종속되지 않는 순수한 POJO로 개발할 수 있다는 것**이다.  
DAO 인터페이스는 기술과 상관없는 단순한 DTO나 도메인 모델만을 사용하기 때문에 언제든지 목 오브젝트 같은 테스트 대역 오브젝트로 대체해서 단위 테스트를 작성할 수 있다.

### DAO 인터페이스와 DI

DAO와 인터페이스는 다음과 같이 만들어야 한다.

- 인터페이스를 이용해 접근하고 DI 되도록 만들어야 함
- 구체적인 데이터 액세스 기술과 관련된 어떤 API나 정보도 노출하지 않아야 함
- DAO를 사용하는 서비스 계층 코드에서 의미 있는 메서드만 인터페이스로 공개해야 함
- 특정 데이터 액세스 기술에서만 의미 있는 DAO 메서드의 이름은 피해야 함(좀 더 일반적인 add(), update()와 같은 이름 선택)

### 예외 처리

데이터 액세스 중에 발생하는 예외는 대부분 복구할 수 없는 예외이기 때문에 DAO 밖으로 던져질 때는 런타임 예외여야 한다.  
또한 DAO 메서드 선언부에 throws SQLException과 같은 내부 기술을 드러내는 예외를 직접 노출해선 안 된다.

스프링은 특정 기술이나 DB의 종류에 상관없이 일관된 의미를 가지는 데이터 예외 추상화를 제공하고, 각 기술과 DB에서 발생하는 예외를 스프링의 데이터 예외로 변환해 주는 변환 서비스를 제공한다.
JdbcTemplate과 같은 템플릿/콜백 기능을 사용하면 변환 서비스가 자동으로 적용된다.  
데이터 액세스 기술의 API를 직접 사용할 때는 스프링에 내장된, AOP를 이용해 예외를 전환해 주는 기능을 사용하면 된다.

최신 데이터 액세스 기술은 JDBC와는 다르게 런타임 예외를 사용한다.  
기술에 독립적인 추상 예외로 전환하고 일관된 예외 복구 기능을 적용할 필요가 없다면 굳이 스프링의 예외 변환 서비스를 사용하지 않아도 된다.
