# 2.3 리팩토링은 어떨 때 필요한가

리팩토링은 따로 시간을 정해서 하면 안 되고 일상적으로 틈틈이 해야 한다.  
리팩토링은 작성해서 하는 게 아니라, 뭔가 다른 걸 해야겠는데 리팩토링을 실시하면 그 작업이 쉬워지기 때문에 하는 것이다.

## 같은 작업의 삼진 아웃 때

돈 로버츠(Don Roberts)는 어떤 작업을 처음 할 땐 그냥 하고, 비슷한 작업을 두 번째 해야 할 땐 중복 작업이라 좀 망설여져도 일단 그냥 하고, 세 번째 하게 되면 그때 리팩토링을 실시해야 한다고 한다.

같은 작업을 3번째 반복하게 됐을 때 리팩토링을 실시하자.

## 기능을 추가할 때

리팩토링이 절실히 필요한 첫 번째 상황은 소프트웨어에 새 기능을 추가해야 할 때다.  
이 시점에 해야 하는 이유는 코드를 이해하기 쉽게 만들기 위해서다.

리팩토링이 절실히 필요한 두 번째 상황은 설계가 지저분해서 어떤 기능을 추가하기 힘들 때다.  
설계를 보고 "이 코드를 이런 식으로 설계했더라면 이 기능을 추가하기 쉬웠을 텐데" 하는 생각이 들 땐 과거의 잘못에 연연하지 않고 리팩토링을 실시해서 설계를 수정해야 한다.  
이것은 나중에 수정을 쉽게 하려는 목적도 있지만, 무엇보다 리팩토링이 최단 지름길임을 알기 때문이다.

## 버그를 수정할 때

버그를 수정할 때는 주로 코드를 이해하기 쉽게 만들려고 리팩토링한다.  
코드의 기능을 파악하려다 이해하기 힘들면 이해하기 쉽게 만들려고 리팩토링을 실시한다.  
이렇게 적극적으로 리팩토링하고 나면 버그 찾기가 쉬워진다.  
버그 리포트를 받았을 정도면 여태까지 버그가 있는 줄도 몰랐던 만큼 그 코드가 지저분하다는 반증이기 때문이다.

## 코드를 검수할 때

일부 업체에선 정기적으로 코드를 검수한다.  
코드를 정기 검수하는 것만큼 효과적인 일도 없다.  
코드 검수를 통해 개발 팀원 모두가 코드를 파악하게 되며, 선임 개발자가 경험이 적은 개발자에게 지식을 전수하는 결과도 얻게 된다.  
결국 방대한 소프트웨어 시스템의 더 많은 부분을 더 많은 사람이 이해하게 된다.  
코드 검수는 명료한 코드를 작성하기 위해서도 꼭 필요하다.
자신의 코드는 자기가 볼 땐 쉬울지 몰라도 다른 팀원은 알아보기 힘들 수 있다.  
사람마다 지식과 경험 분야가 다르기 때문에 어쩔 수 없다.  
코드를 검수하는 동안 더 많은 이들의 기발한 아이디어를 제안받을 기회도 생긴다.  
혼자서는 일주일에 아무리 많은 아이디어를 떠올려도 생각에 그치게 된다.  
하지만 다른 이들의 도움을 얻으면 모든 일이 훨씬 쉬워지니 코드 검수를 자주 하는 것이 좋다.

리팩토링을 하면 다른 사람이 개발한 코드를 검수하기도 쉬워진다.  
리팩토링을 몇 차례 실시하면 거기에 아이디어를 구현했을 때 그 코드가 어떤 구조로 변할지 더 훤히 알 수 있다.  
코드 구조를 생각하지 않아도 어떻게 될지 빤히 보인다.  
따라서 리팩토링 없이는 영영 몰랐을 한 차원 높은 아이디어를 떠올릴 수 있다.

리팩토링하면 코드 검수 결과도 더 구체적으로 나온다.  
단순히 아이디어를 떠올리는 것에 그치지 않고 아이디어를 코드의 해당 부분에 직접 구현할 수도 있다.

제대로 된 검수 공정을 위해선 소규모 검수팀을 조직해야 한다.  
검수팀은 검수자 한 명과 최초 코드 작성자들로 구성하는 게 좋다.  
검수자의 임무는 수정할 부분을 제안하고 그 수정 사항이 무리 없이 리팩토링될 수 있는지 판단하고, 문제가 없다면 수정 작업을 진행하는 것이다.

대규모 설계를 검수할 땐 일반적으로 큰 검수팀에서 다양한 자문을 구하는 것이 좋다.  
이때 그 그룹에 코드를 보여주는 것보다는 UML 다이어그램과 CRC 카드를 이용한 시나리오 전개를 발표하는 방식이 좋다.

> ## 리팩토링의 효용성
>
> \- 켄트 백(Kent Beck)
>
> 프로그램이 지닌 가치는 두 종류다.  
> 하나는 현재의 기능이라는 가치이고, 또 하나는 미래의 기능이라는 가치다.  
> 프로그래밍할 때 개발자는 주로 그 프로그램에 현재 무슨 기능을 넣을지에 전념한다.  
> 버그를 수정하든 새 기능을 추가하든, 그것은 프로그램의 성능을 높임으로써 현재 기능의 가치를 높이는 일이다.
>
> 프로그램의 현재 기능은 그저 일부에 불과하다는 사실을 깨우치지 않으면 개발자로서 오래 가지 못한다.  
> 오늘 일을 오늘 할 수 있어도 내일 일을 내일 할 능력이 없다면 개발자로서 실패하게 된다.
>
> 리팩토링을 실시하면 이런 곤경에서 벗어날 수 있다.  
> 과거의 판단이 현재를 기준으로 불합리하다는 사실을 발견했다면 그 판단을 수정해야 한다.  
> 그래야 현재의 작업을 할 수 있다.
>
> 프로그램은 다음 4가지 상황일 때 수정하기 힘들어진다.
>
> - 코드를 알아보기 힘들 때
> - 중복된 로직이 들어 있을 때
> - 추가 기능을 넣어야 해서 실행 중인 코드를 변경해야 할 때
> - 조건문 구조가 복잡할 때
>
> 그러므로 프로그램은 코드를 알아보기 쉽고, 모든 로직이 한곳에 있으며, 기존 기능을 건드릴 필요 없이 조건문 구조가 최대한 간결하게끔 작성해야 한다.  
> 리팩토링은 실행 중인 프로그램의 기능을 바꾸는 작업이 아니고 신속한 개발 공정을 가능하게 하는 이런 성질을 가중하면서 가치를 높이는 일이다.
