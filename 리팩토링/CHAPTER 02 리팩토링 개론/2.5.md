# 2.5 리팩토링 관련 문제들

생산성을 대폭 높여주는 새 기술을 배울 때 그 기술이 적용되지 않는 상황을 알기란 힘들다.  
개발자는 그 기술을 그저 하나의 프로젝트나 특정 상황에 국한하여 배우는 것이 보통이다 보니, 그 기술이 어떤 요인으로 인해 효과가 감소하거나 오히려 치명적이 되는지 알아내기 어렵다.

리팩토링의 장점을 손에 넣으려면 리팩토링을 실제로 실시하는 것도 중요하지만 과정을 모니터링하는 것도 중요하다.  
리팩토링을 공부하면 할수록 더 많은 문제 해결 방법을 찾게 되고 해결하기 힘든 문제가 무엇인지도 알게 된다.

## 데이터베이스

리팩토링에서 문제 되는 부분 중 하나가 바로 데이터베이스다.  
수많은 비즈니스 애플리케이션은 바탕이 되는 데이터베이스 스키마와 강력히 결합되어 있다.  
이 때문에 데이터베이스 수정이 어려워지는 것이다.  
또 다른 우유로는 데이터 이전 문제를 들 수 있다.  
아무리 데이터베이스 스키마와 객체 모델의 상호 의존성을 최소화하려고 시스템을 꼼꼼하게 계층 구조로 제작했더라도, 데이터베이스 스키마를 수정하면 데이터도 이전해야 하는데, 이것은 시간도 오래 걸릴 뿐 아니라 위험성도 높다.

## 인터페이스 변경

객체의 중대한 장점 하나는 인터페이스를 건드리지 않고 내부의 구현 코드를 수정할 수 있다는 점이다.  
객체를 이용하는 부분을 수정하지 않고도 객체의 내부 구조를 안전하게 수정할 수 있지만, 인터페이스를 수정하면 무슨 문제가 생길지 알 수 없으므로 인터페이스를 건드리지 않을 수 있다는 것은 큰 장점이다.

리팩토링에서 불안한 점은 상당수의 리팩토링이 인터페이스를 건드린다는 것이다.  
[메서드명 변경](../CHAPTER%2010%20메서드%20호출%20단순화/10.1.md)같이 간단한 기법은 그 자체가 인터페이스를 수정하는 작업이다.  
그렇다면 이것이 객체의 주요 개념인 캡슐화에서는 어떤 영향을 미칠까?

메서드를 사용하는 모든 코드에 접근할 수 있다면 메서드명을 변경하는 것쯤은 문제가 되지 않는다.  
심지어 메서드가 public이라고 해도 그 메서드를 호출하는 부분을 찾아 수정할 수만 있다면 메서드명을 바꿔도 상관없다.

그러나 인터페이스가 사용되는 부분을 찾는 게 불가능하거나 수정할 수 없을 경우엔 문제가 생긴다.  
그럴 경우 그 인터페이스는 published 인터페이스(public 인터페이스보다 한 단계 더 적극적으로 공개된)가 된다.  
한 번 배포(publish) 타입이 된 인터페이스는 안전하게 수정할 수 없으며 호출자만 수정하는 것이 불가능해지므로 더 복잡한 절차를 수행해야 한다.

어떤 리팩토링 기법이 배포 인터페이스를 건드릴 경우 개발자는 적어도 그 인터페이스를 사용하는 부분이 그 인터페이스 변경에 맞춰 수정되기 전까지는 기존 인터페이스와 새 인터페이스를 모두 그대로 유지시켜야 한다.  
다행스럽게도 이렇게 하는 일은 그리 어렵지 않다.  
대체로 깔끔하게 정리하는 것만으로도 기존 인터페이스까지 계속 사용할 수 있다.  
기존 인터페이스가 새 인터페이스를 호출하게 하면 된다.

인터페이스를 유지하는 것은 가능하긴 해도 불편하고 까다롭다.  
최소한 일정 기간 동안은 이러한 불필요한 메서드를 남겨둬야 하기 때문이다.  
이런 메서드로 인해 인터페이스가 복잡해져서 인터페이스 사용만 어려워진다.

## 리팩토링을 어렵게 하는 설계를 수정하는 일

설계 자체에 오류가 있을 때나 설계에 대한 결정이 나중에 바뀌었을 때, 혹은 수정하기 힘들 것 같은 민감한 부분일 때도 과연 자유자재로 리팩토링할 수 있을까?  
거의 모든 경우는 리팩토링으로 해결된다.  
프레임워크 선택이라든지 연동 기술 선택 같은 특정 설계적 판단을 배제한 채 리팩토링 공정은 어렵긴 해도 분명 가능하다.

## 리팩토링하면 안 되는 상황

리팩토링하지 말아야 할 때도 있다.  
대표적으로 코드를 처음부터 새로 작성해야 할 때가 그렇다.  
기존 코드가 지극히 지저분해서 리팩토링은 가능하지만 차라리 완전히 새로 작성하는 게 더 쉬울 때가 있다.

코드가 돌아가지 않는다면 그건 완전히 새로 작성하라는 신호다.  
테스트만 하려다 코드가 버그투성이라 안정화할 수 없음을 알게 될 경우가 바로 그때다.  
코드는 반드시 대부분 제대로 돌아가는 것이 우선이고, 리팩토링은 나중 일임을 명심하다.

납기가 임박했을 때도 리팩토링은 삼가야 한다.  
납기가 가까운 시점에 리팩토링해 봤자 그로 인한 생산성은 납기가 지난 후에야 가시화될 테니 쓸데없다.

납기가 임박한 경우가 아니면 시간이 없다는 핑계로 리팩토링을 미루면 안 된다.  
프로젝트를 몇 개 진행해 보면 리팩토링으로 인한 생산성 향상 결과가 눈에 보인다.

언제나 시간에 쫓긴다면 그건 리팩토링해야 한다는 신호다.
