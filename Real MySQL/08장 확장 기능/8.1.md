# 8.1 전문 검색

전문 검색이란 게시물의 내용이나 제목 등과 같이 문장이나 문서의 내용에서 키워드를 검색하는 기능이다.  
LIKE 같은 패턴 일치 검색은 인덱스를 사용하지 못할 수도 있지만, 전문 검색은 일부만 검색하는 경우에도 전문 검색 인덱스를 이용하기 때문에 빠른 검색이 가능하다.

## 8.1.1 전문 검색 엔진의 종류와 특성

MySQL에서 전문 검색을 사용하는 방법은 누가 전문 검색 엔진을 개발했느냐에 따라 다음의 2가지 이름으로 구분할 수 있다.

- MySQL 서버에 기본 내장된 전문 검색 엔진(MySQL 빌트인 전문 검색 엔진)
- 트리톤이나 mGroonga 등과 같이 MySQL 서버에 패치나 플러그인 형태로 내장할 수 있는 전문 검색 엔진(주로 MySQL 이외의 제3의 회사에서 개발)

## 8.1.2 MySQL 빌트인 전문 검색

MySQL의 빌트인 전문 검색은 MyISAM 스토리지 엔진을 사용하는 테이블에서만 사용할 수 있다.  
또한, 구분자(Stopword) 기반의 키워드 추출 알고리즘을 사용하기 때문에 지정된 구분자에 의해서만 인덱싱이 처리된다.  
MySQL 서버에는 이미 기본적인 구분자가 등록되어 있다.  
대표적으로 "a", "the" 또는 "by" 등과 같이 검색어로서는 아무 의미가 없는 단어나 띄어쓰기나 공백 또는 탭과 같은 문자로 구성되어 있다.

### 전문 검색 쿼리

전문 검색을 사용하려면 일반적으로 사용하는 SQL 과는 조금 문법이 다른 MATCH() ... AGAINST() 구문을 사용해야 한다.  
일반적으로 전문 검색은 영문의 대소문자를 구분하지 않지만 만약 구분이 필요하다면 전문 검색 대상 칼럼의 콜레이션을 "_bin"이나 "_cs" 계열로 변경하면 영문 대소문자를 구분한 검색을 수행할 수 있다.  
전문 검색은 크게 자연어 모드와 불리언 모드로 구분된다.

- 자연어 모드
  - 입력된 검색어에서 키워드를 추출한 뒤에 키워드를 포함하는 레코드를 검색하는 방법
  - 입력된 검색어의 키워드가 얼마나 더 많이 포함되어 있는지에 따라 매치율(매치 스코어)이 결정됨
  - 전체 테이블에서 50% 이상의 레코드가 검색된 키워드를 가지고 있으면 그 키워드는 검색어로서 의미가 없다고 판단하고 검색 결과에서 배제됨
- 불리언 모드
  - 각 키워드의 포함 및 불포함 비교를 수행하고, 그 결과를 TRUE 또는 FALSE 형태로 연산해서 최종 일치 여부를 판단하는 방법
  - 불리언 모드의 전문 검색을 사용하려면 AGAINST()에 IN BOOLEAN MODE 키워드를 명시해야 함

## 8.1.3 트리톤 전문 검색

트리톤 전문 검색 엔진은 MySQL의 빌트인 전문 검색에서 제공하는 기능은 전부 지원한다.  
추가로 인덱스의 섹셔나이징(Sectionizing)이나 정규화, 문서의 미리 보기(Snippet) 등의 기능도 제공한다.

### 인덱스 섹셔나이징(Sectionizing)과 가중치 사용

전문 검색 인덱스는 여러 개의 칼럼을 이용해 복합 인덱스로 만들 수도 있으며, 또한 개발 칼럼에 대해 각각 전문 인덱스를 생성할 수도 있다.  
하지만 어떤 경우에도 MATCH() 절의 괄호 안에는 사용하려는 전문 인덱스를 구성하는 칼럼이 모두 명시돼야 한다.

인덱스가 많아지면 INSERT나 UPDATE 또는 DELETE 처리가 느려지고 테이블 저장 공간 사용량도 커질 것이다.  
트리톤에서는 이런 단점을 보완하기 위해 인덱스 섹셔나이징 기능을 제공한다.  
전문 인덱스가 섹셔나이징되어 생성되면 각 섹션 별로 가중치를 별도로 설정할 수 있다.

## 8.1.4 mGroonga 전문 검색

트리톤의 전문 검색 기능은 상당히 안정적이며 MySQL 빌트인 전문 검색 엔진보다 많은 기능과 빠른 성능을 제공한다.  
하지만 트리톤 MySQL의 소스 코드를 패치해서만 사용할 수 있기 때문에 MySQL 버전에 의존적이라는 단점이 있다.  
이러한 단점을 보완하기 위해 mGroonga라는 해결 방법이 제시됐다.

### mGroonga를 이용한 전문 검색 인덱스 생성

mGroonga에는 다음과 같이 두 가지 실행 모드가 있다.

- 스토리지 엔진 모드
  - mGroonga 스토리지 엔진이 전문 인덱스와 테이블 데이터를 모두 관리하는 방식
- 래퍼 모드
  - 테이블 데이터는 MyISAM이나 InnoDB에 저장하고 데이터의 인덱스만 mGroonga 스토리지 엔진이 관리하는 방식
