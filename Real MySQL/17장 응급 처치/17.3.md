# 17.3 MySQL 복구(데이터 파일 손상)

MySQL 서버에서 데이터 파일의 손상은 MyISAM 테이블(ARCHIVE와 CSV 테이블 포함)과 InnoDB 테이블에 대해서 나눠서 생각해 볼 수 있다.

## 17.3.1 MyISAM

MyISAM 테이블에서는 잘못된 조작으로 인해 인덱스나 데이터 파일이 손상될 수 있다.  
이때는 REPAIR TABLE 명령으로 MyISAM의 데이터 파일이나 인덱스 파일을 다시 복구하는 것이 가능하다.  
하지만 데이터 페이지가 손상됐다면 테이블의 일부를 복구하지 못할 수도 있다.

## 17.3.1 InnoDB

InnoDB 테이블은 하드웨어나 운영체제의 문제가 아니라면 InnoDB 데이터 파일이나 로그 파일이 손상될 가능성은 상당히 낮은 편이다.  
하지만 한번 문제가 생기면 복구하기가 쉽지 않다.  
InnoDB 데이터 파일은 기본적으로 MySQL 서버가 시작될 때 항상 자동 복구를 수행한다.  
이 단계에서 자동으로 복구될 수 없는 손상이 있다면 자동 복구를 멈추고 MySQL 서버는 종료되어 버린다.  
이때는 MySQL 서버의 설정 파일에 "innodb_force_recovery" 옵션을 추가해 MySQL 서버를 시작해야 한다.  
이 설정 값은 MySQL 서버가 시작될 때 InnoDB 스토리지 엔진이 데이터 파일이나 로그 파일의 손상 여부 검사 과정을 선별적으로 진행할 수 있게 한다.

- 로그 파일이 손상되었다면 6으로 설정하고 MySQL 서버 기동
- 데이터 파일이 손상되었다면 1로 설정하고 MySQL 서버 기동
- 어떤 부분이 문제인지 알 수 없다면 설정값을 1부터 6까지 변경하면서 MySQL 서버 재시작

일단 MySQL 서버가 기동되고 InnoDB 테이블이 인식된다면 mysqldump를 이용해 데이터를 가능한 만큼 백업하고 그 데이터로 MySQL 서버의 DB와 테이블을 다시 생성하는 것이 좋다.
