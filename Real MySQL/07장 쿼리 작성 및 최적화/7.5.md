# 7.5 INSERT

## 7.5.1 INSERT와 AUTO_INCREMENT

MySQL에서는 순차적으로 증가하는 숫자 값을 가져오기 위해 AUTO_INCREMENT라는 기능을 제공한다.  
여러 테이블에 동시에 사용할 수 있는 AUTO_INCREMENT 기능이 필요할 때는 일련번호 생성을 위한 별도의 테이블을 생성해서 사용할 수 있다.

### AUTO_INCREMENT 제약 및 특성

테이블에서 AUTO_INCREMENT 칼럼을 사용할 때는 반드시 다음 규칙을 지켜야 한다.

- AUTO_INCREMENT 속성을 가진 칼럼은 반드시 프라이머리 키나 유니크 키의 일부로 정의돼야 함
- AUTO_INCREMENT 속성을 가진 칼럼 하나로 프라이머리 키를 생성할 때는 아무런 제약이 없음
- 여러 개의 칼럼으로 프라이머리 키를 생성할 때
  - AUTO_INCREMENT 속성의 칼럼이 제일 앞일 때
    - MyISAM이나 InnoDB 테이블 둘 다 아무런 제약이 없음
  - AUTO_INCREMENT 속성의 칼럼이 제일 앞이 아닐 때
    - MyISAM: 제약 없음
    - InnoDB: UNIQUE INDEX(c2)와 같이 해당 칼럼으로 시작하는 UNIQUE 키를 하나 더 생성해야 함

### AUTO_INCREMENT 잠금

여러 커넥션에서 AUTO_INCREMENT를 동시에 사용할 때는 동기화 처리가 필요한데, 이를 위해 MySQL에서는 AutoIncrement 잠금이라는 테이블 단위의 잠금을 사용한다.  
AutoIncrement 잠금은 AUTO_INCREMENT의 현재 값을 가져올 때만 잠금이 걸렸다가 즉시 해제된다. (트랜잭션과 관련 없음)  
AUTO_INCREMENT 값이 INSERT 문장으로 한 번 증가하면 해당 INSERT 문장을 포함하는 트랜잭션이 ROLLBACK 되더라도 원래의 값으로 되돌아가지 않는다.

## 7.5.2 INSERT IGNORE

로그나 이력 성격의 테이블과 같이 프라이머리 키나 유니크 키가 중복되는 레코드는 그냥 버려도 무방할 때가 있다.  
이때 INSERT 문장에 IGNORE 옵션만 추가하면 프라이머리 키나 유니크 키로 인한 중복 에러가 발생해도 해당 레코드는 무시하고 계속 작업할 수 있다.
