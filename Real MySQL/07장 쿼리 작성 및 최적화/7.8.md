# 7.8 스키마 조작 (DDL)

데이터베이스 구조 및 정의를 생성하거나 변경하는 쿼리를 `DDL(Data Definition Language)`이라고 한다.  
스토어드 프로시저나 함수, DB나 테이블 등을 생성하거나 변경하는 대부분의 명령이 DDL에 해당한다.  
이런 DDL 가운데 **인덱스나 칼럼을 추가하고 삭제하는 작업은 테이블의 모든 레코드를 임시 테이블로 복사하면서 처리되므로 매우 주의**해야 한다.

## 7.8.1 데이터베이스

MySQL에서는 하나의 인스턴스는 1개 이상의 데이터베이스를 가질 수 있는데, MySQL의 데이터베이스는 단순히 테이블을 모아서 그룹으로 만들어 둔다는 개념으로 사용한다.

## 7.8.2 테이블

### 테이블 생성

TEMPORARY 키워드를 사용하면 해당 데이터베이스 커넥션(세션)에서만 사용 가능한 임시 테이블을 생성한다.

각 칼럼은 "칼럼명 + 칼럼 타입 + [타입별 옵션] + [NULL 여부] + [기본값]"의 순서대로 명시하고, 각 타입별로 다음과 같은 옵션을 추가로 사용할 수 있다.

- 모든 칼럼은 공통적으로 칼럼의 초기값을 명시하는 DEFAULT 절과, 칼럼이 NULL이 될 수 있는지 여부를 나타내고자 NULL 또는 NOT NULL 제약을 명시할 수 있음
- 문자열 타입
  - 반드시 칼럼에 최대한 저장할 수 있는 문자 수를 명시해야 함
  - CHARACTER SET 절은 칼럼에 저장되는 문자열 값이 어떤 문자 집합을 사용할지를 결정하고, COLLATE로 비교나 정렬 규칙을 나타내고자 콜레이션 설정 가능
- 숫자 타입
  - 선택적으로 길이를 가질 수 있지만, 이는 실제 칼럼에 저장될 값의 길이를 의미하는 것이 아님
  - 양수만 가질지 음수와 양수를 모두 저장할지에 따라 선택적으로 UNSIGNED 키워드 명시 가능 (기본 값: SIGNED)
  - 숫자 값의 왼쪽에 '0'을 패딩하려면 ZEROFILL 키워드 사용
- 날짜 타입
  - DATE, DATETIME은 특별히 명시할 수 있는 옵션 없음
  - TIMESTAMP는 어떤 조작을 할 때 값이 자동으로 현재 시간으로 업데이트할지를 결정하는 옵션 추가 명시 가능
- ENUM, SET
  - 타입의 이름 뒤에 해당 칼럼이 가질 수 있는 값을 괄호로 정의해야 함

### 테이블 구조

테이블의 구조를 변경하려면 `ALTER TABLE` 명령을 사용한다.  
ALTER TABLE 명령은 테이블 자체의 속성을 변경할 수 있을 뿐더러 인덱스의 추가/삭제나 칼럼을 추가/삭제하는 용도로도 사용된다.

테이블의 문자 집합을 변경하는 명령은 테이블 내에 이미 존재하는 칼럼의 문자 집합을 변경하는 것이 아니고 앞으로 추가될 칼럼의 기본 문자 집합만 변경하는 명령이다.  

스토리지 엔진을 변경하는 명령은 내부적인 테이블의 저장소를 변경하는 것이라서 항상 테이블의 모든 레코드를 복사하는 작업이 필요하다.  
이 명령은 실제 테이블의 스토리지 엔진을 변경하는 목적으로도 사용되지만, 테이블 데이터를 리빌드하는 목적으로도 사용된다.  
테이블 리빌드 작업은 주로 레코드의 삭제가 자주 발생하는 테이블에서 데이터가 저장되지 않은 빈 공간(프래그멘테이션, Fragmentation)을 제거해 디스크의 공간을 줄이는 역할을 한다.

### RENAME TABLE

MySQL에서는 RENAME TABLE 명령을 실행할 때 네임 락(Name Lock)이라는 잠금을 사용하여 RENAME TABLE 명령에 있는 모든 테이블에 대해 한 번에 잠금을 걸고 작업을 진행한다.  

RENAME TABLE 명령은 시스템적으로(운영체제 레벨에서) 원자성(Atomicity) 작업이 아니다.  

- MyISAM: *.FRM, *.MYD, *.MYI 파일 이름 변경 필요
- InnoDB: *.FRM 파일 이름 변경과 InnoDB 스토리지 엔진 내에서 관리되는 딕셔너리 정보의 변경 필요

### 테이블 삭제

일반적으로 MySQL에서 레코드가 많지 않은 테이블을 삭제하는 작업은 서비스 도중이라 하더라도 문제되지 않는다.  
레코드 건수가 많은 테이블을 삭제하는 작업은 상당히 부하가 큰 작업에 속한다.

MySQL에서 테이블을 삭제하려면 반드시 LOCK_open이라는 잠금을 획득해야 한다.
