# 15.1 문자열(CHAR와 VARCHAR)

문자열 칼럼을 사용할 때는 우선 CHAR 타입과 VARCHAR 타입 중 어떤 타입을 사용할지 결정해야 한다.

## 15.1.1 저장 공간

CHAR와 VARCHAR의 가장 큰 공통점은 문자열을 저장할 수 있는 데이터 타입이라는 점이고, 가장 큰 차이는 고정 길이인지 가변 길이인지에 대한 여부다.

- 고정 길이
  - 실제 입력되는 칼럼 값의 길이에 따라 사용하는 저장 공간의 크기가 변하지 않음
  - 실제 저장된 값의 유효 크기가 얼마인지 별도로 저장할 필요가 없으므로 추가 공간이 필요하지 않음
- 가변 길이
  - 최대로 저장할 수 있는 값의 길이는 제한되어 있지만, 그 이하 크기의 값이 저장되면 그만큼 저장 공간이 줄어듦
  - 저장된 값의 유효 크기가 얼마인지를 별도로 저장해야 하기 때문에 1~2바이트의 저장 공간이 추가로 더 필요함

VARCHAR 타입의 길이가 255바이트 이하이면 1바이트만 사용하고 타입의 길이가 256바이트 이상으로 설정되면 2바이트를 길이를 저장하는 데 사용된다.  
VARCHAR 타입의 최대 길이는 2바이트로 표현할 수 있는 이상은 사용할 수 없다.  
즉, VARCHAR 타입의 최대 길이는 65536 이상으로 설정할 수 없다.

문자열 값의 길이가 항상 일정하다면 CHAR를 사용하고, 가변적이라면 VARCHAR를 사용하는 것이 일반적이다.  
실제 문자열 값의 길이가 정적이냐 가변적이냐만으로 CHAR와 VARCHAR 타입을 결정하는 것은 적절하지 않다.  
CHAR 타입과 VARCHAR 타입을 결정할 때 중요한 판단 기준은 다음과 같다.

- 저장되는 문자열의 길이가 대개 비슷한가?
- 칼럼의 값이 자주 변경되는가?

기존에 저장되어 있는 문자열보다 길이가 더 긴 값으로 변경하려고 할 때 CHAR 타입은 문제 되지 않지만, **VARCHAR 타입은 레코드 자체를 다른 공간으로 옮기거나(Row migration) 칼럼 값의 나머지 부분을 다른 공간에 저장(Row chaining)해야 한다.**  
레코드의 이동이나 분리는 CHAR 타입으로 인해 발생하는 2~3바이트 공간 낭비보다 더 큰 공간이나 자원을 낭비하게 만든다.

MySQL에서 CHAR나 VARCHAR 뒤에 지정하는 숫자는 그 칼럼의 바이트 크기가 아니라 문자의 수를 의미한다.  
즉, CHAR(10) 또는 VARCHAR(10)으로 칼럼을 정의하면, 이 칼럼은 10바이트를 저장할 수 있는 공간이 아니라 10글자(문자)를 저장할 수 있는 공간을 의미한다.
