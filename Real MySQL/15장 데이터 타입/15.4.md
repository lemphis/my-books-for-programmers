# 15.4 ENUM과 SET

ENUM과 SET은 모두 문자열 값을 MySQL 내부적으로 숫자 값으로 매핑해서 관리하는 타입이다.  
일반적으로 데이터베이스를 사용하다 보면 타입이나 상태 등과 같이 수많은 코드 형태의 칼럼을 사용하게 되는데, 실제 데이터베이스에는 이미 인코딩된 알파벳이나 숫자 값만 저장되므로 그 의미를 바로 파악하기가 쉽지 않다는 단점이 있다.

## 15.4.1 ENUM

ENUM 타입의 가장 큰 용도는 코드화된 값을 관리하는 것이다.  
ENUM 타입은 INSERT나 UPDATE, 그리고 SELECT 등의 쿼리에서 CHAR나 VARCHAR 타입과 같이 문자열처럼 비교하거나 저장할 수 있다.  
하지만 MySQL 서버가 실제로 값을 디스크나 메모리에 저장할 때는 사용자로부터 요청된 문자열이 아니라 그 값에 매핑된 정숫값을 사용한다.  
ENUM 타입에 사용할 수 있는 최대 문자열의 개수는 65,535개이며, 문자열의 종류가 255개 미만이면 ENUM 타입은 저장 공간으로 1바이트를 사용하고, 그 이상인 경우에는 2바이트까지 사용한다.

ENUM 타입을 사용할 때 일반적으로 특정 문자열 값이 어떤 정숫값으로 매핑되었는지는 알 필요가 없다.  
하지만 필요하다면 1을 곱한다거나 0을 더하는 산술 연산을 적용하는 방법으로 ENUM 타입의 실제 값을 확인할 수 있다.  
ENUM 타입에서 매핑되는 정숫값은 일반적으로 테이블 정의에 나열된 순서대로 1부터 할당되며, 빈 문자열은 항상 0으로 매핑된다.

ENUM 타입의 가장 큰 단점은 칼럼에 저장되는 문자열 값이 테이블의 구조(메타 정보)가 되면서 기존의 ENUM 타입에 새로운 값을 추가해야 한다면 테이블의 구조를 변경해야 한다는 점이다.  
MySQL 5.1부터는 ENUM 타입이 기존 값은 변경되지 않고 새로운 문자열 값이 마지막에 추가되면 MySQL 서버는 테이블의 데이터는 변경하지 않고 MySQL 테이블의 메타 정보면 변경하므로 빠르게 처리된다.  
하지만 기존에 있던 값들 사이에 새 문자열 값을 넣어야 하는 경우는 기존에 매핑된 정숫값이 달라져야 하기 때문에 테이블의 데이터까지 모두 변경되어야 하므로 상당한 시간이 걸릴 수 있다.

ENUM 타입은 우리가 일반적으로 사용하는 상태나 카테고리와 같이 코드화된 칼럼을 MySQL이 자체적으로 제공하는 기능이기 때문에 ENUM 타입의 칼럼 값으로 정렬을 수행하면 매핑되기 전의 문자열 값 기준으로 정렬되는 것이 아니라 매핑된 코드 값으로 정렬이 수행된다.

## 15.4.2 SET

SET 타입도 문자열 값을 정숫값으로 매핑해서 저장하는 방식은 동일하다.  
SET과 ENUM의 가장 큰 차이는 SET은 하나의 칼럼에 1개 이상의 값을 저장할 수 있다는 점이다.  
MySQL 서버는 내부적으로 BIT-OR 연산을 거쳐 1개 이상의 선택된 값을 저장한다.  
즉 SET 타입의 칼럼은 여러 개의 값을 저장할 수는 있지만 실제 여러 개의 값을 저장하는 공간을 가지는 것이 아니다.  
그래서 각 문자열 값에 매핑되는 정숫값은 1씩 증가되는 정숫값이 아니라 2n의 값을 가지게 된다.  
SET 타입은 문자열 값의 멤버 수가 8개 이하이면 1바이트의 저장 공간을 사용하며, 9개에서 16개 이하이면 2바이트를 사용하고 똑같은 방식으로 최대 8바이트까지 저장 공간을 사용한다.

SET 타입의 칼럼에서 특정 문자열 멤버를 가진 레코드를 검색해야 할 때는 FIND_IN_SET() 함수나 LIKE 검색을 이용할 수 있다.  
SET 타입의 칼럼에 대해 동등 비교(Equal)를 수행하려면 칼럼에 저장된 순서대로 문자열을 나열해야만 검색할 수 있다.  
SET 타입의 칼럼에 인덱스가 있더라도 동등 비교 조건을 제외하고 FIND_IN_SET() 함수나 LIKE를 사용하는 쿼리는 인덱스를 사용할 수 없다.
