# 13.1 자바

자바 프로그램 언어로 MySQL 데이터베이스에 접속해서 SQL을 실행하려면 자바에서 제공하는 표준 데이터베이스 접속 API인 JDBC를 이용해야 한다.

## 13.1.1 JDBC 버전

JDBC 드라이버는 DBMS가 발전함에 따라 기능도 확장되고 새로운 기능이 추가되면서 버전이 올라가고 있다.  
일반적으로 JDBC 버전은 JDBC-1 또는 JDBC-3과 같이 드라이버의 주요 버전(Major version)만 언급해서 표현한다.

## 13.1.2 MySQL Connector/J를 이용한 개발

### MySQL 서버 접속

Connector/J를 이용해 MySQL 서버에 접속하려면 JDBC URL이라는 개념을 알아야 한다.  
여기서 URL은 일반적으로 HTTP나 FTP에서 사용하는 URL이 아니라 접속할 MySQL 서버의 정보를 표준 포맷으로 조합한 문자열이다.  
때로는 이를 커넥션 스트링(Connection string)이라고 표현하기도 한다.

### Statement와 PreparedStatement의 차이

Statement와 PreparedStatement의 차이를 알아보려면 우선 MySQL 서버가 처리하는 각 단계를 이해해야 한다.

1. MySQL 서버로 쿼리 요청
2. MySQL 서버는 쿼리 분석 후 파스 트리 생성
3. 파스 트리 정보를 분석하여 권한 체크 및 쿼리 최적화
4. 최종적으로 준비된 쿼리의 실행 계획을 이용하여 쿼리 실행

자바 프로그램에서 Statement로 실행되는 쿼리는 위의 모든 단계를 매번 거쳐서 쿼리가 실행되는데, 쿼리 분석이나 최적화와 같은 작업은 상대적으로 시간이 걸리는 작업이다.  
하지만 `PreparedStatement`를 사용하면 **쿼리 분석이나 최적화의 일부 작업을 처음 한 번만 수행해 별도로 저장**해 두고, **다음부터 요청되는 쿼리는 저장된 분석 결과를 재사용**한다.  
PreparedStatement를 사용할 때 쿼리의 분석 정보를 MySQL 서버의 메모리에 저장해 준다.

PreparedStatement의 장점은 다음과 같다.

- 성능적 측면
  - 한 번 실행된 쿼리는 매번 쿼리 분석 과정을 거치지 않고 처음 분석된 정보 재사용
  - SQL 문장 자체가 네트워크로 전송되지 않고 바인딩할 변숫값만 전달되므로 네트워크 트래픽 측면에서 조금 더 효율적임
  - 바이너리 프로토콜을 사용하기 때문에 불필요하게 문자열 타입으로 데이터를 변환하는 과정을 거치지 않음
- 보안적 측면
  - SQL 인젝션 공격 방어 가능(MySQL Connector/J에서 이스케이프 문자 처리를 처리함)

### 프리페어 스테이트먼트의 종류

- 클라이언트 프리페어 스테이트먼트
  - PreparedStatement 객체를 이용해 변수가 포함된 SQL 문장을 실행할 때 Connector/J가 SQL 문장의 바인딩 변수에 값을 매핑해 하나의 완성된 SQL 문장으로 만들어 서버에 전송하는 방식
  - MySQL 서버는 매번 쿼리 문장을 분석하고 실행 계획을 수립해서 쿼리 실행
- 서버 프리페어 스테이트먼트
  - 다른 DBMS에서 일반적으로 프리페어 스테이트먼트라고 표현하는 방식
  - 매번 쿼리를 실행할 때마다 클라이언트는 SQL 문장에 바인딩할 변숫값만 전송하고, MySQL 서버는 저장된 쿼리의 분석 정보에 변숫값을 바인딩 해서 쿼리 실행
