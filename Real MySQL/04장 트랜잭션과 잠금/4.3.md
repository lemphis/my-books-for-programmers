# 4.3 MyISAM과 MEMORY 스토리지 엔진의 잠금

MyISAM이나 MEMORY 스토리지 엔진은 자체적인 잠금을 가지지 않고 **MySQL 엔진에서 제공하는 테이블 락을 그대로 사용**한다.  
그리고 MyISAM이나 MEMORY 스토리지 엔진에서는 쿼리 단위로 필요한 잠금을 한꺼번에 모두 요청해서 획득하기 때문에 데드락이 발생할 수 없다.

## 4.3.1 잠금 획득

- 읽기 잠금
  - 테이블에 쓰기 잠금이 걸려 있지 않으면 바로 읽기 잠금을 획득하고 읽기 작업을 시작할 수 있음
- 쓰기 잠금
  - 테이블에 아무런 잠금이 걸려 있지 않아야만 쓰기 잠금을 획득할 수 있고, 그렇지 않다면 다른 잠금이 해제될 때까지 대기

## 4.3.2 잠금 튜닝

테이블 락에 대하 작업 상황은 MySQL의 상태 변수를 통해 확인할 수 있다.

```sql
SHOW STATUS LIKE 'Table%';
```

결과 중 "Table_locks_immediate"는 다른 잠금이 풀리기를 기다리지 않고 바로 잠금을 획득한 횟수이며, "Table_locks_waited"는 다른 잠금이 이미 해당 테이블을 사용하고 있어서 기다려야 하던 횟수이다.

InnoDB 스토리지 엔진의 경우 레코드 단위의 잠금을 사용하기 때문에 집계에 포함되지 않는다.

## 4.3.3 테이블 수준의 잠금 확인 및 해제

MyISAM이나 MEMORY 등과 같은 스토리지 엔진을 사용하는 테이블은 모두 테이블 단위의 잠금이므로 테이블을 해제하지 않으면 다른 클라이언트에서 그 테이블을 사용하는 것이 불가능하다.  
하나의 테이블에서 전혀 다른 레코드라 하더라도 동시에 변경하는 것은 불가능하기 때문에 쿼리 처리의 동시성이 떨어지게 된다.

MySQL에서 테이블의 잠금을 획득하는 방법은 두 가지가 있다.

- LOCK TABLES 명령을 이용해 명시적으로 획득하는 방법
- SELECT나 INSERT, UPDATE 등(또는 DDL 명령)과 같은 쿼리 문장을 이용해 묵시적으로 획득하는 방법
