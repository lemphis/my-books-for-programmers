# 16.4 큰 문자열 칼럼의 인덱스(해시)

가끔 매우 긴 문자열을 저장하는 칼럼에 대해 인덱스를 생성하거나 검색을 수행해야 할 때가 있다.  
이러한 요건은 주로 URL 정보를 관리할 때 필요한데, 일반적으로 URL 정보는 인덱스를 생성하기에는 상당히 부담스러울 정도로 큰 데이터가 많다.  
때로는 긴 문자열 칼럼을 프라이머리 키로 사용해야 할 때도 있다.  
하지만 MyISAM이나 InnoDB 테이블의 인덱스는 하나의 레코드가 767바이트를 넘을 수 없다.  
이때는 칼럼의 앞 부분 767바이트만 잘라서 프라이머리 키나 유니크 키로 생성할 수 있는데, 이를 프리픽스(Prefix) 인덱스라고 한다.  
그런데 프리픽스 인덱스는 반드시 칼럼의 앞 부분 767바이트만으로 유니크해야 한다는 제약이 있기 때문에 칼럼의 앞 부분 767바이트가 중복될 수 있다면 유니크 인덱스나 프라이머리 키를 사용하지 못하게 된다.  
이럴 때는 **긴 문자열의 해시 값으로 프라이머리 키나 유니크 인덱스를 생성하는 방법을 사용**하면 쉽게 해결할 수 있다.

일반적으로 해시 값을 생성하기 위해 MD5()나 SHA()와 같은 비대칭 암호화 함수가 자주 사용된다.  
MySQL의 MD5() 함수는 16바이트의 해시 코드를 생성하며, SHA() 함수는 20바이트의 해시 코드를 생성하기 때문에 MD5() 함수나 SHA() 함수를 이용해 생성된 해시 값을 저장하려면 다음과 같은 타입의 칼럼이 필요하다.

|       | 문자열(16진 헥사 스트링)로 저장했을 때 | 바이너리 값을 저장했을 때 |
| :---- | :------------------------------------- | :------------------------ |
| MD5() | CHAR(32)                               | BINARY(16)                |
| SHA() | CHAR(40)                               | BINARY(20)                |
