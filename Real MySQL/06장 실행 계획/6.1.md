# 6.1 개요

## 6.1.1 쿼리 실행 절차

MySQL 서버에서 쿼리가 실행되는 과정은 크게 3가지로 나눌 수 있다.

1. 사용자로부터 요청된 SQL 문장을 잘게 쪼개서 MySQL 서버가 이해할 수 있는 수준으로 분리
   - SQL 파싱(Parsing) 단계에 해당함
   - MySQL 서버의 SQL 파서라는 모듈로 처리
   - SQL 문장이 잘못됐다면 이 단계에서 걸러짐
   - SQL 파스 트리가 생성됨
2. SQL의 파싱 정보(파스 트리)를 확인하면서 어떤 테이블부터 읽고 어떤 인덱스를 이용해 테이블을 읽을지 선택
   - 최적화 및 실행 계획 수립의 단계
   - MySQL 서버의 **옵티마이저**에서 처리
   - 쿼리의 실행 계획이 만들어짐
   - 다음과 같은 작업을 처리
     - 불필요한 조건의 제거 및 복잡한 연산 단순화
     - 여러 테이블의 조인이 있는 경우 어떤 순서로 테이블을 읽을지 결정
     - 각 테이블에 사용된 조건과 인덱스 통계 정보를 이용해 사용할 인덱스 결정
     - 가져온 레코드들을 임시 테이블에 넣고 다시 한 번 가공해야 하는지 결정
3. 두 번째 단계에서 결정된 테이블의 읽기 순서나 선택된 인덱스를 이용해 스토리지 엔진으로부터 데이터를 가져옴
   - 수립된 실행 계획대로 스토리지 엔진에 레코드를 읽어오도록 요청
   - MySQL 엔진에서는 스토리지 엔진으로부터 받은 레코드를 조인하거나 정렬하는 작업을 수행

## 6.1.2 옵티마이저의 종류

- 비용 기반 최적화(Cost-based optimizer, CBO)
  - 쿼리를 처리하기 위한 여러 가지 가능한 방법을 만들고, 각 단위 작업의 비용(부하) 정보와 대상 테이블의 예측된 통계 정보를 이용해 각 실행 계획별 비용 산출
  - 산출된 각 실행 방법별로 최소 비용이 소요되는 처리 방식을 선택하여 최종 쿼리 실행
- 규칙 기반 최적화(Rule-based optimizer, RBO)
  - 대상 테이블의 레코드 건수나 선택도 등을 고려하지 않고 옵티마이저에 내장된 우선순위에 따라 실행 계획을 수립하는 방식
  - 같은 쿼리에 대해서 거의 항상 같은 실행 방법을 만들어냄
  - 이미 오래 전부터 많은 DBMS에서 거의 지원되지 않거나 업데이트되지 않은 상태로 남아 있음

## 6.1.3 통계 정보

비용 기반 최적화에서 가장 중요한 것은 통계 정보다.  
MySQL은 다른 DBMS와 같이 비용 기반의 최적화를 사용하지만 다른 DBMS보다 통계 정보는 그리 다양하지 않다.  
레코드 건수가 많지 않으면 통계 정보가 상당히 부정확한 경우가 많으므로 **ANALYZE** 명령을 이용해 강제적으로 통계 정보를 갱신해야 할 때도 있다.
