# 3.8 MySQL 로그 파일

MySQL은 다른 상용 DBMS와 비교하면 DBA나 개발자를 위한 진단 도구가 상당히 부족한 편이다.  
그렇지만 로그 파일을 이용하면 MySQL의 상태나 부하를 일으키는 원인을 찾아서 해결할 수 있다.

## 3.8.1 에러 로그 파일

MySQL이 실행되는 도중에 발생하는 에러나 경고 메시지가 출력되는 로그 파일이다.  
에러 로그 파일의 위치는 MySQL configuration 파일에 "log_error"라는 이름의 파라미터에 정의된 경로에 있는 파일이거나, 별도로 정의되지 않은 경우에는 데이터 디렉터리("datadir" 파라미터에 설정된 디렉터리)에 ".err"이라는 확장자가 붙은 파일이다.  
아래는 자주 보게 되는 에러 메시지다.

- MySQL이 시작하는 과정과 관련된 정보성 및 에러 메시지
  - MySQL의 configuration 파일을 변경하거나 데이터베이스가 비정상적으로 종료된 이후 다시 시작하는 경우에는 반드시 MySQL 에러 로그 파일을 통해 설정된 변수의 이름이나 값이 명확하게 설정되고 의도한 대로 적용됐는지 확인해야 함
- 마지막으로 종료될 때 비정상적으로 종료된 경우 나타나는 InnoDB의 트랜잭션 복구 메시지
  - InnoDB의 경우 MySQL 서버가 비정상적으로 종료됐다면 다시 시작되면서 완료되지 못한 트랜잭션을 정리하고 디스크에 기록되지 못한 데이터를 다시 기록하는 재처리 작업을 진행
  - 간혹 문제가 있어서 복구되지 못할 때는 해당 에러 메시지를 출력하고 MySQL은 다시 종료됨
- 쿼리 처리 도중에 발생하는 문제에 대한 에러 메시지
  - 쿼리 실행 도중 에러가 발생했다거나, 복제에서 문제가 될 만한 쿼리에 대한 경고 메시지가 에러 로그에 기록됨
- 비정상적으로 종료된 커넥션 메시지 (Aborted connection)
  - 클라이언트 애플리케이션에서 정상적으로 접속 종료를 하지 못하고 프로그램이 종료된 경우 에러 로그 파일에 기록됨
- InnoDB의 모니터링 명령이나 상태 조회 명령("SHOW ENGINE INNODB STATUS"와 같은)의 결과 메시지
  - InnoDB의 테이블 모니터링이나 락 모니터링 또는 InnoDB의 엔진 상태를 조회하는 명령은 상대적으로 큰 메시지를 에러 로그 파일에 기록함
  - 모니터링을 사용한 이후에는 반드시 비활성화해서 에러 로그 파일이 커지지 않게 만들어야 함
- MySQL의 종료 메시지
  - MySQL이 아무도 모르게 종료돼 있거나 아무도 모르게 재시작되는 경우는 에러 로그 파일에서 MySQL이 출력한 메시지를 확인하는 것이 이유를 알 수 있는 유일한 방법임

## 3.8.2 제너럴 로그 쿼리 파일 (제너럴 로그 파일, General log)

가끔 MySQL 서버에서 실행되는 쿼리로 어떤 것들이 있는지 전체 목록을 뽑아서 검토해 볼 때가 있는데, 이때는 쿼리 로그를 활성화해서 쿼리를 쿼리 로그 파일로 기록하게 하여 해당 파일을 검토하면 된다.  
쿼리 로그 파일에는 시간 단위로 실행됐던 쿼리의 내용이 모두 기록된다.  
MySQL 5.1 이상에서는 쿼리 로그를 파일이 아닌 테이블에 저장하도록 설정할 수 있다.

## 3.8.3 슬로우 쿼리 로그

슬로우 쿼리 로그 파일에는 configuration에 정의한 시간(long_query_time 파라미터에 초 단위로 설정됨) 이상의 시간이 소요된 쿼리가 모두 기록된다.  
슬로우 쿼리 로그는 MySQL이 쿼리를 실행한 후, 실제 소요된 시간을 기준으로 슬로우 쿼리 로그에 기록할지 여부를 판단하기 때문에 반드시 쿼리가 정상적으로 실행이 완료되어야 슬로우 쿼리 로그에 기록될 수 있다.  
MySQL 5.1 이상에서 "log-output" 설정 옵션을 이용해 쿼리를 파일로 기록할지 테이블로 기록할지 선택할 수 있다.

## 3.8.4 바이너리 로그와 릴레이 로그

바이너리 로그는 마스터 서버에 생성되고 릴레이 로그는 슬레이브 서버에 생성된다는 것 말고는 바이너리 로그와 릴레이 로그 파일의 내용이나 포맷은 동일하다.  
바이너리 로그와 릴레이 로그에는 순수한 SELECT 문장과 같이 데이터의 구조나 내용을 변경하지 않는 쿼리는 기록되지 않는다.  
이진 형태의 바이너리 로그와 릴레이 로그 파일을 텍스트 형태로 바꾸려면 MySQL 홈 디렉터리의 bin 디렉터리에 있는 mysqlbinlog라는 프로그램을 이용할 수 있다.
