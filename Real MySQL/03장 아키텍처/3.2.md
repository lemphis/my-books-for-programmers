# 3.2 InnoDB 스토리지 엔진 아키텍처

InnoDB는 MySQL에서 사용할 수 있는 스토리지 엔진 중에서 거의 유일하게 레코드 기반의 잠금을 제공하고 있기 때문에 높은 동시성 처리가 가능하고 안정적이며 성능이 뛰어나다.

## 3.2.1 InnoDB 스토리지 엔진의 특성

- 프라이머리 키에 의한 클러스터링
  - InnoDB의 모든 테이블은 기본적으로 프라이머리 키를 기준으로 클러스터링 되어 저장됨
  - 프라이머리 키값의 순서대로 디스크에 저장되며, 이로 인해 프라이머리 키에 의한 레인지 스캔이 상당히 빨리 처리됨
  - 쿼리의 실행 계획에서 프라이머리 키는 기본적으로 다른 보조 인덱스에 비해 비중이 높게 설정됨
- 잠금이 필요 없는 일관된 읽기 (Non-locking consistent read)
  - MVCC(Multi Version Concurrency Control)라는 기술을 이용해 락을 걸지 않고 읽기 작업 수행
- 자동 데드락 감지
  - InnoDB는 그래프 기반의 데드락 체크 방식을 사용하기 때문에 데드락이 발생함과 동시에 바로 감지됨
  - 데드락이 감지되면 관련 트랜잭션 중에서 ROLLBACK이 가장 용이한 트랜잭션(ROLLBACK 시 복구 작업이 가장 작은 트랜잭션)을 자동으로 강제 종료
- 자동화된 장애 복구
  - InnoDB는 손실이나 장애로부터 데이터를 보호하기 위한 여러 가지 메커니즘이 탑재되어 있음
  - MySQL 서버가 시작될 때, 완료되지 못한 트랜잭션이나 디스크에 일부만 기록된 데이터 페이지(Partial write) 등에 대한 일련의 복구 작업이 자동으로 진행됨

## 3.2.2 InnoDB 버퍼 풀

InnoDB 스토리지 엔진에서 가장 핵심적인 부분으로, **디스크의 데이터 파일이나 인덱스 정보를 메모리에 캐시해 두는 공간**이다.  
**쓰기 작업을 지연시켜 일괄 작업으로 처리할 수 있게 해주는 버퍼 역할**도 같이 한다.  
일반적인 애플리케이션에서는 INSERT, UPDATE, DELETE와 같이 데이터를 변경하는 쿼리는 데이터 파일의 이곳저곳에 위치한 레코드를 변경하기 때문에 랜덤한 디스크 작업을 발생시킨다.  
하지만 버퍼 풀이 이러한 변경된 데이터를 모아서 처리하게 되면 랜덤한 디스크 작업의 횟수를 줄일 수 있다.

InnoDB 버퍼 풀은 아직 디스크에 기록하지 않은 변경된 데이터를 가지고 있다(이러한 데이터를 가지고 있는 페이지를 더티 페이지(Dirty page)라고 한다).  
이러한 더티 페이지는 InnoDB에서 주기적으로 또는 어떤 조건이 되면 체크포인트 이벤트가 발생하는데, 이때 Write 스레드가 필요한 만큼의 더티 페이지만 디스크로 기록한다.
