# 3.5 NDB 클러스터 스토리지 엔진

NDB 클러스터는 다른 스토리지 엔진과는 작동 방식이나 용도가 많이 다르다.  
NDB는 "Network DataBase"의 줄임말로 네트워크를 통해 데이터 분산을 지원하는 스토리지 엔진이라는 의미로 붙여진 이름이다.  
NDB 클러스터 데이터의 분산이나 그로 인한 성능 향상보다는 가용성에 집중된 스토리지 엔진이다.

## 3.5.1 NDB 클러스터의 특성

### 무공유(Shared-nothing) 클러스터링

NDB 클러스터는 클러스터 그룹 내의 모든 노드가 아무것도 공유하지 않는 무공유(Shared-nothing) 아키텍처로 구현되어 있다.  
NDB 클러스터는 관리 노드(Management node)와 데이터 노드(Data node), SQL 노드(API 노드라고도 함)로 구성되는데, 3가지 종류의 노드 모두 이중화해서 구현할 수 있기 때문에 SPoF가 되는 부분을 제거할 수 있다.

### 메모리 기반의 스토리지 엔진

NDB 클러스터는 메모리를 기본 데이터 스토리지로 사용한다.  
NDB 클러스터는 주기적으로 메모리의 모든 데이터를 디스크로 내려쓰고 있으며, InnoDB 스토리지 엔진과 같이 트랜잭션 로그를 디스크에 기록하는 식으로 작동한다.

### 자동화된 페일 오버(Fail-over)

NDB 클러스터는 모든 구성 노드가 서로의 상태를 계속 체크하고 있기 때문에 특정 노드에 문제가 발생해도 다른 사용 가능한 노드가 그 역할을 이어받는 형태로 페일 오버가 가능하다.

### 분산된 데이터 저장소 간의 동기 방식(Sync) 복제

NDB 클러스터에서 데이터 저장소는 분산되어 관리되는데, 각 데이터 저장소는 전체 데이터를 N등분해서 자신이 전담하는 파티션(프라이머리 파티션)과 백업으로 보조 파티션(세컨더리 파티션)을 구성한다.

### 온라인 스키마 변경

NDB 클러스터에서는 테이블에 칼럼이나 인덱스를 추가하면서 동시에 INSERT나 UPDATE와 같은 DML 쿼리를 처리할 수 있다.

### NoSQL (MySQL과의 독립성)

NDB 클러스터는 MySQL과는 별도로 작동하는 데이터 저장소이기 때문에 MySQL 서버가 없어도 다른 NoSQL 도구와 같이 NDB 클러스터를 사용할 수 있다.

## 3.5.2 NDB 클러스터의 아키텍처

### NDB 클러스터 노드의 종류

NDB 클러스터는 관리 노드, 데이터 노드, SQL 노드로 구성되어 있으며, 각 노드는 SPoF를 방지하기 위해 모두 이중화될 수 있도록 구현되어 있다.

- 관리 노드 (Management node)
  - NDB 클러스터의 전체적인 구조에 대한 정보를 다른 노드에게 전파하거나 각 노드의 장애 상황을 전파하는 역할 담당
  - NDB 클러스터가 정상 상태에서 서비스되는 도중에는 시스템의 자원 사용률이 낮음
  - NDB 클러스터 내의 각 노드에 대한 IP 주소나 포트 번호와 같은 정보와 각 노드의 주요 환경 설정값을 가지고 있음
- 데이터 노드 (Data node)
  - 클러스터에 대한 전반적인 작업 수행 노드
  - 데이터를 저장하는 스토리지를 관리하고 데이터에 관련된 모든 요청 처리
  - 내부적으로 데이터의 클러스터링을 위해 데이터를 쪼개고(파티션, Partition) 해당 데이터를 복사해서 백업(레플리카, Replica) 수행
- SQL 노드 (SQL node, API node)
  - MySQL 서버를 이용해 NDB 클러스터에 접속하는 경우를 SQL 노드라고 함
  - 자바나 C 같은 프로그래밍 언어를 이용해 NDB 클러스터에 접속하는 경우를 API 노드라고 함

## 3.5.3 클러스터 간의 복제 구성

NDB 클러스터에서도 MySQL의 복제(레플리케이션)를 적용할 수 있는데, 이런 경우는 특별히 클러스터 간 복제라고 표현한다.  
NDB 클러스터의 데이터 노드는 자기 자신에게 발생한 데이터 변경에 대한 내용을 MySQL 서버(SQL 노드)로 피드백을 주게 되며, 이 피드백을 받은 MySQL 서버에서 그러한 내용을 자기 자신의 바이너리 로그에 기록하는 방식으로 클러스터 전체의 데이터 변경에 대한 바이너리 로그가 생성된다.
