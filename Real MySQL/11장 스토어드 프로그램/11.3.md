# 11.3 스토어드 프로그램의 권한 및 옵션

스토어드 프로시저나 함수 그리고 이벤트나 트리거는 각각 생성이나 변경 또는 실행에 관해서 서로 다른 권한들이 필요하다.  
SUPER 권한을 지닌 계정 하나로 데이터베이스 개발 및 서비스가 이뤄진다면 권한과 관련된 부분은 문제 되지 않지만 서비스용 계정에 SUPER 권한을 부여하는 것은 흔치 않으므로 사용하는 스토어드 프로그램의 종류에 맞게 권한을 부여하는 작업이 필요하다.

## 11.3.1 DEFINER와 SQL SECURITY 옵션

각 스토어드 프로그램을 생성하고 실행하는 권한을 살펴보려면 우선 스토어드 프로그램의 DEFINER와 SQL SECURITY 옵션을 이해해야 한다.

- DEFINER
  - 스토어드 프로그램이 기본적으로 가지는 옵션으로 해당 스토어드 프로그램의 소유권과 같은 의미를 지님
  - SQL SECURITY 옵션에 설정된 값에 따라 조금씩은 다르지만 스토어드 프로그램이 실행될 때의 권한으로 사용되기도 함
- SQL SECURITY
  - 스토어드 프로그램을 실행할 때 누구의 권한으로 실행할지 결정하는 옵션
  - INVOKER 또는 DEFINER 둘 중 하나로 선택 가능
  - DEFINER는 스토어드 프로그램을 생성한 사용자를 의미
  - INVOKER는 스토어드 프로그램을 호출(실행) 한 사용자를 의미

DEFINER는 모든 스토어드 프로그램이 기본적으로 가지는 옵션이지만, SQL SECURITY 옵션은 스토어드 프로시저와 스토어드 함수, 뷰만 가질 수 있다.  
SQL SECURITY 옵션을 가지지 않는 트리거나 이벤트는 자동적으로 SQL SECURITY가 DEFINER로 설정되므로 트리거나 이벤트는 DEFINER에 명시된 사용자의 권한으로 항상 실행된다.

스토어드 프로그램을 생성하면서 DEFINER 옵션을 부여하지 않으면 기본적으로 현재 사용자로 DEFINER가 자동 설정된다.  
하지만 DEFINER를 다른 사용자로 설정할 때는 스토어드 프로그램을 생성하는 사용자가 SUPER 권한을 가지고 있어야 한다.

## 11.3.2 스토어드 프로그램의 권한

### 스토어드 프로시저와 함수

스토어드 프로시저나 함수의 생성 및 실행에 관려하는 권한으로는 다음의 4개의 권한이 있다.

- SUPER
  - 서버 전체적으로 영향력을 가지는 글로벌 권한
  - 스토어드 프로시저나 함수를 생성하고 실행할 수 있음
- CREATE ROUTINE
  - DB 또는 오브젝트 단위로 부여되므로 DB 권한이 될 수도 있고 오브젝트 권한으로도 사용자에게 부여될 수 있음
  - 일반적으로는 DB 수준으로 권한을 부여하며, 이 권한을 가진 사용자는 스토어드 프로시저나 함수를 생성(CREATE) 할 수 있음
- ALTER ROUTINE
  - DB 또는 오브젝트 단위로 부여
  - 일반적으로는 DB 수준으로 권한을 부여하며, 이 권한을 가진 사용자는 스토어드 프로시저나 함수를 변경(ALTER) 할 수 있음
  - 프로시저나 함수의 조회(SHOW PROCEDURE) 또는 삭제(DROP PROCEDURE)를 위해 필요한 권한
- EXECUTE
  - DB 또는 오브젝트 단위로 부여
  - 일반적으로는 DB 수준으로 권한을 부여하며, 이 권한을 가진 사용자는 스토어드 프로시저나 함수를 실행(CALL 또는 SELECT) 할 수 있음

### 트리거

트리거와 관련된 권한으로는 두 가지가 있다.  
트리거는 별도의 SQL 문으로 실행되는 것이 아니라 지정된 테이블에 어떠한 변화가 있을 때 자동적으로 실행되는데, 트리거가 포함된 테이블에 INSERT나 UPDATE 또는 DELETE와 같은 변경을 가할 때는 권한 설정에 특별히 주의해야 한다.

- SUPER
  - MySQL 5.1.6 이전의 버전에서는 트리거를 생성하거나 실행하기 위해 SUPER 권한 필요
- TRIGGER
  - MySQL 5.1.6 버전부터 추가된 권한으로 트리거를 생성하거나 실행, 삭제하는 데 필요한 권한

### 이벤트

이벤트는 MySQL 5.1.6부터 추가된 스케줄러 기능으로 이벤트에 관련된 권한인 EVENT는 MySQL 5.1.12부터 추가됐다.  
MySQL 5.1.6~5.1.12까지의 버전에서는 트리거와 마찬가지로 이벤트 생성이나 삭제에 SUPER 권한이 필요하다.  
이벤트와 관련된 권한은 다음 두 가지가 있다.

- SUPER
  - 다른 스토어드 프로그램과 마찬가지로 EVENT 권한이 제공되지 않았을 때 이를 대체하기 위해 사용
  - SUPER 권한의 효력은 EVENT 권한이 지원되는 MySQL 5.1.12 이후의 버전에서도 계속 유지됨
- EVENT
  - 이벤트를 생성하거나 변경 또는 삭제하는 데 필요한 권한으로 MySQL 5.1.12 버전부터 지원

### 뷰

MySQL에서 뷰를 생성할 때는 DEFINER와 SQL SECURITY 보안 옵션을 명시해야 한다.  
뷰를 생성하거나 삭제하려면 다음의 세 가지 권한을 적절히 가지고 있어야 한다.

- CREATE VIEW
  - 뷰를 생성하거나 변경(ALTER, CREATE OR REPLACE VIEW) 하는 데 필요한 권한
- DROP
  - 뷰를 삭제(DROP VIEW) 하는 데 필요한 권한
- SHOW VIEW
  - 뷰의 내용을 조회(SHOW CREATE VIEW) 하는 데 필요한 권한
  - 내용의 조회라는 의미는 뷰를 통해 참조할 수 있는 데이터 레코드를 의미하는 것이 아니라 어떠한 SQL로 해당 뷰가 정의되었는지를 의미

## 11.3.3 DETERMINISTIC과 NOT DETERMINISTIC 옵션

DETERMINISTIC과 NOT DETERMINISTIC은 스토어드 프로그램의 보안에 관련된 옵션이 아니라 성능에 관련된 옵션이다.  
이 두 옵션은 서로 배타적이라서 둘 중에서 반드시 하나를 선택해야 한다.

- DETERMINISTIC 이란 스토어드 프로그램의 입력이 같다면 시점이나 상황에 관계없이 결과가 항상 같다(결정적이다) 는 것을 의미
- NOT DETERMINISTIC 이란 입력이 같아도 시점에 따라 결과가 달라질 수도 있음을 의미

NOT DETERMINISTIC은 WHERE 절이 비교를 수행하는 레코드마다 매번 값이 재평가(호출) 되므로 상당한 성능 저하를 유발한다.  
NOT DETERMINISTIC은 스토어드 함수의 디폴트 옵션이므로 어떠한 형태로 스토어드 함수를 사용하더라도 DETERMINISTIC 옵션을 꼭 설정하자.
