# 6.6 트랜잭션 속성

## 6.6.1 트랜잭션 정의

트랜잭션이라고 모두 같은 방식으로 동작하는 것은 아니다.  
물론 트랜잭션의 기본 개념인 더 이상 쪼갤 수 없는 최소 단위의 작업이라는 개념은 항상 유효하다.  
따라서 트랜잭션 경계 안에서 진행된 작업은 commit()을 통해 모두 성공하든지 아니면 rollback()을 통해 모두 취소돼야 한다.  
그런데 이 밖에도 트랜잭션의 동작 방식을 제어할 수 있는 몇 가지 조건이 있다.

`DefaultTransactionDefinition`이 구현하고 있는 `TransactionDefinition` 인터페이스는 트랜잭션의 동작 방식에 영향을 줄 수 있는 네 가지 속성을 정의하고 있다.

1. `트랜잭션 전파 (transaction propagation)`
    - 트랜잭션 경계에서 이미 진행 중인 트랜잭션이 있을 때 또는 없을 때 어떻게 동작할 것인가를 결정하는 방식
    - 다음과 같은 트랜잭션 전파 속성을 부여할 수 있음
      - PROPAGATION_REQUIRED
        - 진행 중인 트랜잭션이 없으면 새로 시작하고, 이미 시작된 트랜잭션이 있으면 이에 참여
        - 가장 많이 사용되는 트랜잭션 전파 속성
      - PROPAGATION_REQUIRES_NEW
        - 항상 새로운 트랜잭션을 시작
        - 앞에서 시작된 트랜잭션이 있든 없든 상관없이 새로운 트랜잭션을 만들어서 독자적으로 동작하게 함
        - 독립적인 트랜잭션이 보장돼야 하는 코드에 적용
      - PROPAGATION_NOT_SUPPORTED
        - 트랜잭션 없이 동작하게 함 (진행 중인 트랜잭션이 있어도 무시)
        - 트랜잭션 경계 설정은 보통 AOP를 이용해 한 번에 많은 메서드에 동시에 적용하는 방법을 사용하기 때문에 특정 메서드의 트랜잭션 전파 속성만 PROPAGATION_NOT_SUPPORTED로 설정하여 트랜잭션 없이 동작하게 함
    - 트랜잭션 매니저를 통해 트랜잭션을 시작하려고 할 때 getTransaction()이라는 메서드를 사용하는 이유는 바로 트랜잭션 전파 속성이 있기 때문 (항상 새로 시작하는 게 아니기 때문에 beginTransaction() 등의 이름을 사용하지 않음)
2. `격리 수준 (isolation level)`
    - 모든 DB 트랜잭션은 격리 수준을 가지고 있어야 함
    - 적절하게 격리 수준을 조정해서 가능한 한 많은 트랜잭션을 동시에 진행시키면서도 문제가 발생하지 않게 하는 제어가 필요
    - 격리 수준은 기본적으로 DB에 설정되어 있지만 JDBC 드라이버나 DataSource 등에서 재설정 가능하며, 필요하다면 트랜잭션 단위로 격리 수준 조정 가능
    - DefaultTransactionDefinition에 설정된 격리 수준은 ISOLATION_DEFAULT (DataSource에 설정되어 있는 디폴트 격리 수준을 따름)
    - 기본적으로는 DB나 DataSource에 설정된 디폴트 격리 수준을 따르는 편이 좋지만, 특별한 작업을 수행하는 메서드의 경우에는 독자적인 격리 수준을 지정할 필요가 있음
3. `제한 시간 (timeout)`
    - 트랜잭션을 수행하는 제한 시간 설정 가능
    - DefaultTransactionDefinition의 기본 설정은 제한 시간이 없음
    - 트랜잭션을 직접 시작할 수 있는 PROPAGATION_REQUIRED, PROPAGATION_REQUIRES_NEW와 함께 사용해야만 의미가 있음
4. `읽기 전용 (readonly)`
    - 읽기 전용으로 설정해두면 트랜잭션 내에서 데이터를 조작하는 시도를 막을 수 있음
    - 데이터 액세스 기술에 따라서 성능이 향상될 수 있음
