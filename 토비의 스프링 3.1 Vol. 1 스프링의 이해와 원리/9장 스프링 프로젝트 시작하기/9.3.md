# 9.3 애플리케이션 아키텍처

아키텍처는 여러 가지 방식으로 정의되고 이해될 수 있는 용어다.  
가장 단순한 정의는 **어떤 경계 안에 있는 내부 구성 요소들이 어떤 책임을 가지고 있고, 어떤 방식으로 서로 관계를 맺고 동작하는지를 규정하는 것**이라고 할 수 있다.  
아키텍처는 단순히 정적인 구조를 나타내는 것으로만 생각하기 쉽지만 실제로는 그 구조에서 일어나는 동적인 행위와 깊은 관계가 있다.

## 9.3.1 계층형 아키텍처

성격이 다른 모듈이 강하게 결합되어 한데 모여 있으면 한 가지 이유로 변경이 일어날 때 그와 상관이 없는 요소도 함께 영향을 받게 된다.  
따라서 불필요한 부분까지 변경이 일어나고 그로 인해 작업은 더뎌지고 오류가 발생할 가능성이 높아지고, 어느 부분을 수정해야 할지를 파악하기도 쉽지 않다.  
따라서 인터페이스와 같은 유연한 경계를 만들어 두고 분리하거나 모아주는 작업이 필요하다.

### 아키텍처와 SoC

성격이 다른 것은 아키텍처 레벨에서 분리해 주는 게 좋다.  
분리된 각 오브젝트는 독자적으로 개발과 테스트가 가능해서 개발과 변경 작업이 모두 빨라질 수 있다.  
이렇게 책임과 성격이 다른 것을 크게 그룹으로 만들어 분리해두는 것을 아키텍처 차원에서는 `계층형 아키텍처(layered architecture)`라고 부른다.  
또는 계층이라는 의미를 가진 영어 단어인 티어(tier)를 사용해서 **멀티 티어 아키텍처**라고도 한다.  
보통 웹 기반의 엔터프라이즈 애플리케이션은 일반적으로 세 개의 계층을 갖는다고 해서 **3계층(3-tier 또는 3-layer) 애플리케이션**이라고도 한다.

### 3계층 아키텍처와 수직 계층

3계층 아키텍처는 백엔드의 DB나 레거시 시스템과 연동하는 인터페이스 역할을 하는 `데이터 액세스 계층`, 비즈니스 로직을 담고 있는 `서비스 계층`, 주로 웹 기반의 UI를 만들어 내고 그 흐름을 관리하는 `프레젠테이션 계층`으로 구분한다.

- 데이터 액세스 계층
  - 장기적인 데이터 저장을 목적으로 하는 DB 이용이 주된 책임
  - 외부 시스템을 호출해서 서비스를 이용하는 것은 `기반(infrastructure) 계층`으로 따로 분류하기도 함
- 서비스 계층
  - 잘 만들어진 스프링 애플리케이션의 서비스 계층 클래스는 이상적인 POJO로 작성됨
  - 특별한 경우가 아니라면 추상화 수직 계층 구조를 가질 필요가 없음
- 프레젠테이션 계층
  - 웹과 프레젠테이션 기술은 끊임없이 발전하기 때문에 매우 다양한 기술과 프레임워크의 조합을 가질 수 있음
  - 엔터프라이즈 애플리케이션의 프레젠테이션 계층은 클라이언트의 종류와 상관없이 HTTP 프로토콜을 사용하는 서블릿이 바탕이 됨

### 계층형 아키텍처 설계의 원칙

각 계층은 응집도가 높으면서 다른 계층과는 낮은 결합도를 유지할 수 있어야 한다.  
자신의 역할과 기술에만 충실한 계층을 만들면 각 계층 사이의 결합도는 자연스럽게 낮아진다.  
각 계층이 자신의 책임에 충실하게 작성되어 있다면 필요한 그 밖의 정보는 다른 계층에 요청하게 될 것이다.  
이때는 계층 레벨에 정의한 인터페이스를 통해서 요청을 하게 되고, **계층 간에 사용되는 인터페이스 메서드에는 특정 계층의 기술이 최대한 드러나지 않게 만들어야 한다**.

## 9.3.2 애플리케이션 정보 아키텍처

엔터프라이즈 시스템은 본질적으로 동시에 많은 작업이 빠르게 수행되어야 하는 시스템이다.  
사용자의 작업 상태를 오래 유지할 수 있는 독립 애플리케이션과 달리 엔터프라이즈 애플리케이션은 일반적으로 사용자의 요청을 처리하는 동안만 간단한 상태를 유지한다.

애플리케이션을 사이에 두고 흘러 다니는 정보를 어떤 식으로 다룰지를 경정하는 일도 아키텍처를 결정할 때 매우 중요한 기준이 된다.  
엔터프라이즈 애플리케이션에 존재하는 정보를 단순히 데이터로 다루는 경우와 오브젝트로 다루는 경우, 두 가지 기준으로 구분해 볼 수 있다.

### DB/SQL 중심의 로직 구현 방식

데이터 중심 구조의 특징은 하나의 업무 트랜잭션에 모든 계층의 코드가 종속되는 경향이 있다는 점이다.  
대부분의 코드는 대응되는 작업 단위에 1:1로 매핑된다.  
하나의 업무 트랜잭션을 모두 담은 서비스 계층 코드와 해당 업무에 특화된 SQL을 담은 하나 또는 여러 개의 DAO 메서드로 구성된다.  
서비스 계층이 프레젠테이션 계층에 전달하는 결과의 포맷은 보통 DAO의 SQL 결과와 같고, 웹 페이지의 출력 내용과도 1:1로 대응된다.  

- 장점
  - 초기 개발이 쉬움
- 단점
  - 변화에 매우 취약함
  - 각 계층의 코드가 긴밀하게 연결되어 있기 때문에 객체지향의 장점이 별로 활용되지 못함
  - 중복을 제거하기가 어려움
  - 테스트하기 어려움

### 거대한 서비스 계층 방식

비즈니스 로직을 DB나 SQL에 담는 경우에는 항상 최종 결과만 DAO에서 서비스 계층으로 전달된다.  
반면에 거대 서비스 계층 방식에서는 DAO에서 좀 더 단순한 결과를 돌려준다.  
DAO가 돌려준 정보를 분석, 가공하면서 비즈니스 로직을 적용하는 것은 서비스 계층 코드의 책임이 된다.

- 장점
  - 애플리케이션 코드에 비즈니스 로직이 담겨 있기 때문에 자바 언어의 장점을 활용해 로직 구현 가능
  - 테스트하기 수월함
  - DAO가 다루는 SQL이 복잡하지 않고 프레젠테이션 계층의 뷰와 1:1로 매핑되지 않아도 되기 때문에 일부 DAO 코드를 여러 비즈니스 로직에서 공유 가능
  - 초기 개발 속도가 빠름
  - 개발자 사이에 간섭 없이 독립적인 개발 가능
- 단점
  - 데이터 액세스 계층의 SQL은 서비스 계층의 비즈니스 로직의 필요에 따라 만들어지기 쉬우므로 계층 간의 결합도가 높음
  - 서비스 계층의 메서드는 크기가 큰 업무 트랜잭션 단위로 만들어지기 때문에 비슷한 기능의 코드가 여러 메서드에 중복되어서 나타나기 쉬움
