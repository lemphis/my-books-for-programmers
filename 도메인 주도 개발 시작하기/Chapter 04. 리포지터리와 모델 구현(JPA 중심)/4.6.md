# 4.6 식별자 생성 기능

식별자는 크게 세 가지 방식 중 하나로 생성한다.

- 사용자가 직접 생성
- 도메인 로직으로 생성
- DB를 이용한 일련번호 사용

이메일 주소처럼 사용자가 직접 식별자를 입력하는 경우는 식별자 생성 주체가 사용자이기 때문에 도메인 영역에 식별자 생성 기능을 구현할 필요가 없다.

식별자 생성 규칙이 있다면 엔티티를 생성할 때 식별자를 엔티티가 별도 서비스로 식별자 생성 기능을 분리해야 한다.  
**식별자 생성 규칙은 도메인 규칙이므로 도메인 영역에 식별자 생성 기능을 위치**시켜야 한다.

식별자 생성 규칙을 구현하기에 적합한 장소는 도메인 서비스다.  
응용 서비스는 이 도메인 서비스를 이용해서 식별자를 구하고 엔티티를 생성한다.

식별자 생성 규칙을 구현하기에 적절한 또 다른 장소는 리포지터리다.  
리포지터리 인터페이스에 식별자를 생성하는 메서드를 추가하고 리포지터리 구현 클래스에서 알맞게 구현하면 된다.

DB 자동 증가 칼럼을 식별자로 사용하면 식별자 매핑에서 @GeneratedValue를 사용한다.  
자동 증가 칼럼은 DB의 insert 쿼리를 실행해야 식별자가 생성되므로 도메인 객체를 리포지터리에 저장할 때 식별자가 생성된다.  
이 말은 도메인 객체를 생성하는 시점에는 식별자를 알 수 없고 도메인 객체를 저장한 뒤에 식별자를 구할 수 있음을 의미한다.  
JPA는 저장 시점에 생성한 식별자를 @Id로 매핑한 프로퍼티/필드에 할당하므로 저장 이후에 엔티티의 식별자를 사용할 수 있다.

자동 증가 칼럼 외에 JPA의 식별자 생성 기능을 사용하는 경우에도 마찬가지로 저장 시점에 식별자를 생성한다.
