# 2.3 DIP

고수준 모듈이 제대로 동작하려면 저수준 모듈을 사용해야 한다.  
그런데 고수준 모듈이 저수준 모듈을 사용하면 앞서 계층 구조 아키텍처에서 언급했던 두 가지 문제, 즉 구현 변경과 테스트가 어렵다는 문제가 발생한다.  
`DIP`는 이 문제를 해결하기 위해 저수준 모듈이 고수준 모듈에 의존하도록 바꾼다.  
고수준 모듈을 구현하려면 저수분 모듈에 사용해야 하는데, 반대로 저수준 모듈이 고수준 모듈에 의존하도록 만드는 비밀은 바로 **추상화한 인터페이스**에 있다.

DIP를 적용하면 앞의 다른 영역이 인프라스트럭처 영역에 의존할 때 발생했던 두 가지 문제인 구현 교체가 어렵다는 것과 테스트가 어려운 문제를 해소할 수 있다.  
스프링과 같은 의존 주입을 지원하는 프레임워크를 사용하면 설정 코드를 수정해서 쉽게 구현체를 변경할 수 있다.  
또한 고수준 모듈이 저수준 모듈에 의존하지 않기 때문에 구현 클래스가 없어도 테스트 대역을 이용해 거의 모든 기능을 테스트할 수 있다.

## 2.3.1 DIP 주의사항

DIP를 잘못 생각하면 단순히 인터페이스와 구현 클래스를 분리하는 정도로 받아들일 수 있다.  
DIP의 핵심은 고수준 모듈이 저수준 모듈에 의존하지 않도록 하기 위함인데 DIP를 적용한 결과 구조만 보고 저수준 모듈에서 인터페이스를 추출하는 경우가 있다.  
이런 경우는 여전히 고수준 모듈이 저수준 모듈에 의존하고 있는 것이다.  
DIP를 적용할 때 **하위 기능을 추상화한 인터페이스는 고수준 모듈 관점에서 도출**한다.

## 2.3.2 DIP와 아키텍처

인프라스트럭처 영역은 구현 기술을 다루는 저수준 모듈이고 응용 영역과 도메인 영역은 고수준 모듈이다.  
인프라스트럭처 계층이 가장 하단에 위치하는 계층형 구조와 달리 아키텍처에 DIP를 적용하면 인프라스트럭처 영역이 응용 영역과 도메인 영역에 의존(상속)하는 구조가 된다.  
인프라스트럭처에 위치한 클래스가 도메인이나 응용 영역에 정의한 인터페이스를 상속받아 구현하는 구조가 되므로 도메인과 응용 영역에 대한 영향을 주지 않거나 최소화하면서 구현 기술을 변경하는 것이 가능하다.
