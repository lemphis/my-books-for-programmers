# 85. 자바 직렬화의 대안을 찾으라

직렬화는 공격 범위가 너무 넓고 지속적으로 더 넓어져 방어하기 어렵다.  
ObjectInputStream의 readObject 메서드는 (Serializable 인터페이스를 구현했다면) 클래스패스 안의 거의 모든 타입의 객체를 만들어 낼 수 있는, 사실상 마법 같은 생성자다.  
바이트 스트림을 역직렬화하는 과정에서 이 메서드는 그 타입들 안의 모든 코드를 수행할 수 있다.  
즉, 그 타입들의 코드 전체가 공격 범위에 들어간다.

역직렬화 과정에서 호출되어 잠재적으로 위험한 동작을 수행하는 메서드를 가젯(gadget)이라 부른다.  
여러 가젯을 함께 사용하여 가젯 체인을 구성할 수도 있는데, 가끔씩 공격자가 기반 하드웨어의 네이티브 코드를 마음대로 실행할 수 있는 아주 강력한 가젯 체인도 발견되곤 한다.  
그래서 **아주 신중하게 제작한 바이트 스트림만 역직렬화해야 한다.**

역직렬화에 시간이 오래 걸리는 짧은 스트림을 역직렬화하는 것만으로도 서비스 거부 공격에 쉽게 노출될 수 있다.  
이런 스트림을 역직렬화 폭탄(deserialization bomb)이라고 한다.

**직렬화 위험을 회피하는 가장 좋은 방법은 아무것도 역직렬화하지 않는 것이다.**  
객체와 바이트 시퀀스를 변환해 주는 다른 메커니즘이 많이 있다.  
이 방식들은 자바 직렬화의 여러 위험을 회피하면서 다양한 플랫폼 지원, 우수한 성능, 풍부한 자원 도구, 활발한 커뮤니티와 전문가 집단 등 수많은 이점까지 제공한다.

레거사 시스템 때문에 자바 직렬화를 완전히 배제할 수 없을 때의 차선책은 **신뢰할 수 없는 데이터는 절대 역직렬화하지 않는 것이다.**
