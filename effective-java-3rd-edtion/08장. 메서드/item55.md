# 55. 옵셔널 반환은 신중히 하라

자바 8 전에는 메서드가 특정 조건에서 값을 반환할 수 없을 때 취할 수 있는 선택지가 두 가지 있었고, 각각 허점이 있다.

1. 예외 throw
   - 예외는 진짜 예외적인 상황에서만 사용해야 함
   - 예외를 생성할 때 스택 추적 전체를 캡처하므로 비용도 만만치 않음
2. null 반환
   - (null이 반환될 일이 절대 없다고 확신하지 않는 한) 별도의 null 처리 코드를 추가해야 함
   - null 처리를 무시하고 반환된 null 값을 어딘가에 저장해두면 언젠가 NullPointerException 발생 가능 (null을 반환하게 한 실제 원인과는 전혀 상관없는 코드에서 발생)

자바 버전이 8로 올라가면서 `Optional<T>`이라는 또 하나의 선택지가 생겼다.  
Optional\<T>는 null이 아닌 T 타입 참조를 하나 담거나, 혹은 아무것도 담지 않을 수 있다.  
아무것도 담지 않은 옵셔널은 '비었다'고 말한다.  
반대로 어떤 값을 담은 옵셔널은 '비지 않았다'고 한다.  
**옵셔널은 원소를 최대 1개 가질 수 있는 불변 컬렉션이다.**  
Optional\<T>가 Collection\<T>를 구현하지는 않았지만, 원칙적으로는 그렇다.

보통은 T를 반환해야 하지만 특정 조건에서는 아무것도 반환하지 않아야 할 때 T 대신 Optional\<T>를 반환하도록 선언하면 된다.  
옵셔널을 반환하는 메서드는 예외를 던지는 메서드보다 유연하고 사용하기 쉬우며, null을 반환하는 메서드보다 오류 가능성이 적다.

그렇다면 null을 반환하거나 예외를 던지는 대신 옵셔널 반환을 선택해야 하는 기준은 무엇인가?  
**옵셔널은 검사 예외(checked exception)와 취지가 비슷하다.**
즉, 반환겂이 없을 수도 있음을 API 사용자에게 명확히 알려준다.  
비검사 예외를 던지거나 null을 반환한다면 API 사용자가 그 사실을 인지하지 못해 끔찍한 결과로 이어질 수 있다.  
하지만 검사 예외를 던지면 클라이언트에서는 반드시 이에 대처하는 코드를 작성해넣어야 한다.  
이와 비슷하게, 메서드가 옵셔널을 반환한다면 클라이언트는 값을 받지 못했을 때 취할 행동을 선택해야 한다.

반환값으로 옵셔널을 사용한다고 해서 무조건 득이 되는 건 아니다.  
**컬렉션, 스트림, 배열, 옵셔널 같은 컨테이너 타입은 옵셔널로 감싸면 안 된다.**  
빈 Optional\<List\<T>>를 반환하기보다는 빈 List\<T>를 반환하는 게 좋다.  
빈 컨테이너를 그대로 반환하면 클라이언트에 옵셔널 처리 코드를 넣지 않아도 된다.

**결과가 없을 수 있으며, 클라이언트가 이 상황을 특별하게 처리해야 한다면 Optional\<T>를 반환한다.**

박싱된 기본 타입을 담는 옵셔널은 기본 타입 자체보다 무거울 수밖에 없다.  
그래서 자바 API 설계자는 int, long, double 전용 옵셔널 클래스인 OptionalInt, OptionalLong, OptionalDouble 을 준비해놨다.  
이렇게 대체재가 있으니 **박싱된 기본 타입을 담은 옵셔널을 반환하는 일은 없도록 하자.**

옵셔널을 컬렉션의 키, 값, 원소나 배열의 원소로 사용하는 게 적절한 상황은 거의 없다.
