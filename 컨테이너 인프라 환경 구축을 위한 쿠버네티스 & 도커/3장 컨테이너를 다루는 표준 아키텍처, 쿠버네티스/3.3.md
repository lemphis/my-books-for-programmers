# 3.3 쿠버네티스 연결을 담당하는 서비스

와부에서 쿠버네티스 클러스터에 접속하는 방법을 `서비스(service)`라고 합니다.  
서비스를 '소비를 위한 도움을 제공한다'는 관점으로 바라본다면 쿠버네티스가 외부에서 쿠버네티스 클러스터에 접속하기 위한 '서비스'를 제공한다고 볼 수 있습니다.

## 3.3.1 가장 간단하게 연결하는 노드포트

외부에서 쿠버네티스 클러스터의 내부에 접속하는 가장 쉬운 방법은 `노드포트(NodePort)` 서비스를 이용하는 것입니다.  
노드포트 서비스를 설정하면 모든 워커 노드의 특정 포트(노드포트)를 열고 여기로 오는 모든 요청을 노트포트 서비스로 전달합니다.  
그리고 노드포트 서비스는 해당 업무를 처리할 수 있는 파드로 요청을 전달합니다.

## 3.3.2 사용 목적별로 연결하는 인그레스

노드포트 서비스는 포트를 중복 사용할 수 없어서 1개의 노드포트에 1개의 디플로이먼트만 적용됩니다.  
그렇다면 여러 개의 디플로이먼트가 있을 때 그 수만큼 노드포트 서비스를 구동해야 할까요?  
쿠버네티스에서는 이런 경우에 인그레스를 사용합니다.  
`인그레스(Ingress)`는 고유한 주소를 제공해 사용 목적에 따라 다른 응답을 제공할 수 있고, 트래픽에 대한 L4/L7 로드밸런서와 보안 인증서를 처리하는 기능을 제공합니다.  
인그레스를 사용하려면 인그레스 컨트롤러가 필요합니다. 인그레스 컨트롤러는 파드와 직접 통신할 수 없어서 노드포트 또는 로드밸런서 서비스와 연동되어야 합니다.

## 3.3.3 클라우드에서 쉽게 구성 가능한 로드밸런서

앞에서 처리한 연결 방식은 들어오는 요청을 모두 워커 노드의 노드포트를 통해 노드포트 서비스로 이동하고 이를 다시 쿠버네티스의 파드로 보내는 구조였습니다.  
이 방식은 매우 비효율적입니다.  
그래서 쿠버네티스에서는 `로드밸런서(LoadBalancer)`라는 서비스 타입을 제공합니다.  
로드밸런서를 사용하려면 로드밸런서를 이미 구현해 둔 서비스업체의 도움을 받아 쿠버네티스 클러스터 외부에 구현해야 합니다.

## 3.3.4 온프레미스에서 로드밸런서를 제공하는 MetalLB

온프레미스에서 로드밸런서를 사용하려면 내부에 로드밸런서 서비스를 받아주는 구성이 필요한데, 이를 지원하는 것이 `MetalLB`입니다.  
MetalLB는 베어메탈(bare metal, 운영 체제가 설치되지 않은 하드웨어)로 구성된 쿠버네티스에서도 로드밸런서를 사용할 수 있게 고안된 프로젝트입니다.  
MetalLB는 특별한 네트워크 설정이나 구성이 있는 것이 아니라 기존의 L2 네트워크(ARP/NDP)와 L3 네트워크(BGP)로 로드밸런서를 구성합니다.

## 3.3.5 부하에 따라 자동으로 파드 수를 조절하는 HPA

쿠버네티스는 부하량에 따라 디플로이먼트의 파드 수를 유동적으로 관리하는 기능을 제공합니다.  
이를 `HPA(Horizontal Pod Autoscaler)`라고 합니다.